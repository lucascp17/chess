<!DOCTYPE html>
<html>
	<head>
	</head>
	<body>
		<div id="root"/>
		<!-- <button type="button" onclick="javascript:showBlackWins()" style="position: absolute; left: 10px; top: 600px">Test</button> -->
		<script>

			const WHITE_WINS_LABEL = "White wins";
			const BLACK_WINS_LABEL = "Black wins";
			const CHECK_LABEL = "Check!";

			const BLACK_BISHOP 	= 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSI0NSIgaGVpZ2h0PSI0NSI+CiAgPGcgc3R5bGU9Im9wYWNpdHk6MTsgZmlsbDpub25lOyBmaWxsLXJ1bGU6ZXZlbm9kZDsgZmlsbC1vcGFjaXR5OjE7IHN0cm9rZTojMDAwMDAwOyBzdHJva2Utd2lkdGg6MS41OyBzdHJva2UtbGluZWNhcDpyb3VuZDsgc3Ryb2tlLWxpbmVqb2luOnJvdW5kOyBzdHJva2UtbWl0ZXJsaW1pdDo0OyBzdHJva2UtZGFzaGFycmF5Om5vbmU7IHN0cm9rZS1vcGFjaXR5OjE7Ij4KICAgIDxnIHN0eWxlPSJmaWxsOiMwMDAwMDA7IHN0cm9rZTojMDAwMDAwOyBzdHJva2UtbGluZWNhcDpidXR0OyI+IAogICAgICA8cGF0aAogICAgICAgIGQ9Ik0gOSwzNiBDIDEyLjM5LDM1LjAzIDE5LjExLDM2LjQzIDIyLjUsMzQgQyAyNS44OSwzNi40MyAzMi42MSwzNS4wMyAzNiwzNiBDIDM2LDM2IDM3LjY1LDM2LjU0IDM5LDM4IEMgMzguMzIsMzguOTcgMzcuMzUsMzguOTkgMzYsMzguNSBDIDMyLjYxLDM3LjUzIDI1Ljg5LDM4Ljk2IDIyLjUsMzcuNSBDIDE5LjExLDM4Ljk2IDEyLjM5LDM3LjUzIDksMzguNSBDIDcuNjQ2LDM4Ljk5IDYuNjc3LDM4Ljk3IDYsMzggQyA3LjM1NCwzNi4wNiA5LDM2IDksMzYgeiIgLz4KICAgICAgPHBhdGgKICAgICAgICBkPSJNIDE1LDMyIEMgMTcuNSwzNC41IDI3LjUsMzQuNSAzMCwzMiBDIDMwLjUsMzAuNSAzMCwzMCAzMCwzMCBDIDMwLDI3LjUgMjcuNSwyNiAyNy41LDI2IEMgMzMsMjQuNSAzMy41LDE0LjUgMjIuNSwxMC41IEMgMTEuNSwxNC41IDEyLDI0LjUgMTcuNSwyNiBDIDE3LjUsMjYgMTUsMjcuNSAxNSwzMCBDIDE1LDMwIDE0LjUsMzAuNSAxNSwzMiB6IiAvPgogICAgICA8cGF0aAogICAgICAgIGQ9Ik0gMjUgOCBBIDIuNSAyLjUgMCAxIDEgIDIwLDggQSAyLjUgMi41IDAgMSAxICAyNSA4IHoiIC8+CiAgICA8L2c+CiAgICA8cGF0aAogICAgICAgZD0iTSAxNy41LDI2IEwgMjcuNSwyNiBNIDE1LDMwIEwgMzAsMzAgTSAyMi41LDE1LjUgTCAyMi41LDIwLjUgTSAyMCwxOCBMIDI1LDE4IgogICAgICAgc3R5bGU9ImZpbGw6bm9uZTsgc3Ryb2tlOiNmZmZmZmY7IHN0cm9rZS1saW5lam9pbjptaXRlcjsiIC8+CiAgPC9nPgo8L3N2Zz4K';
			const BLACK_KING 	= 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSI0NSIgaGVpZ2h0PSI0NSI+CiAgPGcgc3R5bGU9ImZpbGw6bm9uZTsgZmlsbC1vcGFjaXR5OjE7IGZpbGwtcnVsZTpldmVub2RkOyBzdHJva2U6IzAwMDAwMDsgc3Ryb2tlLXdpZHRoOjEuNTsgc3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7IHN0cm9rZS1kYXNoYXJyYXk6bm9uZTsgc3Ryb2tlLW9wYWNpdHk6MTsiPgogICAgPHBhdGgKICAgICAgIGQ9Ik0gMjIuNSwxMS42MyBMIDIyLjUsNiIKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7IHN0cm9rZTojMDAwMDAwOyBzdHJva2UtbGluZWpvaW46bWl0ZXI7IgogICAgICAgaWQ9InBhdGg2NTcwIiAvPgogICAgPHBhdGgKICAgICAgIGQ9Ik0gMjIuNSwyNSBDIDIyLjUsMjUgMjcsMTcuNSAyNS41LDE0LjUgQyAyNS41LDE0LjUgMjQuNSwxMiAyMi41LDEyIEMgMjAuNSwxMiAxOS41LDE0LjUgMTkuNSwxNC41IEMgMTgsMTcuNSAyMi41LDI1IDIyLjUsMjUiCiAgICAgICBzdHlsZT0iZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxOyBzdHJva2UtbGluZWNhcDpidXR0OyBzdHJva2UtbGluZWpvaW46bWl0ZXI7IiAvPgogICAgPHBhdGgKICAgICAgIGQ9Ik0gMTEuNSwzNyBDIDE3LDQwLjUgMjcsNDAuNSAzMi41LDM3IEwgMzIuNSwzMCBDIDMyLjUsMzAgNDEuNSwyNS41IDM4LjUsMTkuNSBDIDM0LjUsMTMgMjUsMTYgMjIuNSwyMy41IEwgMjIuNSwyNyBMIDIyLjUsMjMuNSBDIDE5LDE2IDkuNSwxMyA2LjUsMTkuNSBDIDMuNSwyNS41IDExLjUsMjkuNSAxMS41LDI5LjUgTCAxMS41LDM3IHogIgogICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDsgc3Ryb2tlOiMwMDAwMDA7IiAvPgogICAgPHBhdGgKICAgICAgIGQ9Ik0gMjAsOCBMIDI1LDgiCiAgICAgICBzdHlsZT0iZmlsbDpub25lOyBzdHJva2U6IzAwMDAwMDsgc3Ryb2tlLWxpbmVqb2luOm1pdGVyOyIgLz4KICAgIDxwYXRoCiAgICAgICBkPSJNIDMyLDI5LjUgQyAzMiwyOS41IDQwLjUsMjUuNSAzOC4wMywxOS44NSBDIDM0LjE1LDE0IDI1LDE4IDIyLjUsMjQuNSBMIDIyLjUxLDI2LjYgTCAyMi41LDI0LjUgQyAyMCwxOCA5LjkwNiwxNCA2Ljk5NywxOS44NSBDIDQuNSwyNS41IDExLjg1LDI4Ljg1IDExLjg1LDI4Ljg1IgogICAgICAgc3R5bGU9ImZpbGw6bm9uZTsgc3Ryb2tlOiNmZmZmZmY7IiAvPgogICAgPHBhdGgKICAgICAgIGQ9Ik0gMTEuNSwzMCBDIDE3LDI3IDI3LDI3IDMyLjUsMzAgTSAxMS41LDMzLjUgQyAxNywzMC41IDI3LDMwLjUgMzIuNSwzMy41IE0gMTEuNSwzNyBDIDE3LDM0IDI3LDM0IDMyLjUsMzciCiAgICAgICBzdHlsZT0iZmlsbDpub25lOyBzdHJva2U6I2ZmZmZmZjsiIC8+CiAgPC9nPgo8L3N2Zz4K';
			const BLACK_KNIGHT 	= 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSI0NSIgaGVpZ2h0PSI0NSI+CiAgPGcgc3R5bGU9Im9wYWNpdHk6MTsgZmlsbDpub25lOyBmaWxsLW9wYWNpdHk6MTsgZmlsbC1ydWxlOmV2ZW5vZGQ7IHN0cm9rZTojMDAwMDAwOyBzdHJva2Utd2lkdGg6MS41OyBzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDsgc3Ryb2tlLWRhc2hhcnJheTpub25lOyBzdHJva2Utb3BhY2l0eToxOyI+CiAgICA8cGF0aAogICAgICBkPSJNIDIyLDEwIEMgMzIuNSwxMSAzOC41LDE4IDM4LDM5IEwgMTUsMzkgQyAxNSwzMCAyNSwzMi41IDIzLDE4IgogICAgICBzdHlsZT0iZmlsbDojMDAwMDAwOyBzdHJva2U6IzAwMDAwMDsiIC8+CiAgICA8cGF0aAogICAgICBkPSJNIDI0LDE4IEMgMjQuMzgsMjAuOTEgMTguNDUsMjUuMzcgMTYsMjcgQyAxMywyOSAxMy4xOCwzMS4zNCAxMSwzMSBDIDkuOTU4LDMwLjA2IDEyLjQxLDI3Ljk2IDExLDI4IEMgMTAsMjggMTEuMTksMjkuMjMgMTAsMzAgQyA5LDMwIDUuOTk3LDMxIDYsMjYgQyA2LDI0IDEyLDE0IDEyLDE0IEMgMTIsMTQgMTMuODksMTIuMSAxNCwxMC41IEMgMTMuMjcsOS41MDYgMTMuNSw4LjUgMTMuNSw3LjUgQyAxNC41LDYuNSAxNi41LDEwIDE2LjUsMTAgTCAxOC41LDEwIEMgMTguNSwxMCAxOS4yOCw4LjAwOCAyMSw3IEMgMjIsNyAyMiwxMCAyMiwxMCIKICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDsgc3Ryb2tlOiMwMDAwMDA7IiAvPgogICAgPHBhdGgKICAgICAgZD0iTSA5LjUgMjUuNSBBIDAuNSAwLjUgMCAxIDEgOC41LDI1LjUgQSAwLjUgMC41IDAgMSAxIDkuNSAyNS41IHoiCiAgICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7IHN0cm9rZTojZmZmZmZmOyIgLz4KICAgIDxwYXRoCiAgICAgIGQ9Ik0gMTUgMTUuNSBBIDAuNSAxLjUgMCAxIDEgIDE0LDE1LjUgQSAwLjUgMS41IDAgMSAxICAxNSAxNS41IHoiCiAgICAgIHRyYW5zZm9ybT0ibWF0cml4KDAuODY2LDAuNSwtMC41LDAuODY2LDkuNjkzLC01LjE3MykiCiAgICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7IHN0cm9rZTojZmZmZmZmOyIgLz4KICAgIDxwYXRoCiAgICAgIGQ9Ik0gMjQuNTUsMTAuNCBMIDI0LjEsMTEuODUgTCAyNC42LDEyIEMgMjcuNzUsMTMgMzAuMjUsMTQuNDkgMzIuNSwxOC43NSBDIDM0Ljc1LDIzLjAxIDM1Ljc1LDI5LjA2IDM1LjI1LDM5IEwgMzUuMiwzOS41IEwgMzcuNDUsMzkuNSBMIDM3LjUsMzkgQyAzOCwyOC45NCAzNi42MiwyMi4xNSAzNC4yNSwxNy42NiBDIDMxLjg4LDEzLjE3IDI4LjQ2LDExLjAyIDI1LjA2LDEwLjUgTCAyNC41NSwxMC40IHogIgogICAgICBzdHlsZT0iZmlsbDojZmZmZmZmOyBzdHJva2U6bm9uZTsiIC8+CiAgPC9nPgo8L3N2Zz4K';
			const BLACK_PAWN 	= 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSI0NSIgaGVpZ2h0PSI0NSI+CiAgPHBhdGgKICAgIGQ9Ik0gMjIsOSBDIDE5Ljc5LDkgMTgsMTAuNzkgMTgsMTMgQyAxOCwxMy44OSAxOC4yOSwxNC43MSAxOC43OCwxNS4zOCBDIDE2LjgzLDE2LjUgMTUuNSwxOC41OSAxNS41LDIxIEMgMTUuNSwyMy4wMyAxNi40NCwyNC44NCAxNy45MSwyNi4wMyBDIDE0LjkxLDI3LjA5IDEwLjUsMzEuNTggMTAuNSwzOS41IEwgMzMuNSwzOS41IEMgMzMuNSwzMS41OCAyOS4wOSwyNy4wOSAyNi4wOSwyNi4wMyBDIDI3LjU2LDI0Ljg0IDI4LjUsMjMuMDMgMjguNSwyMSBDIDI4LjUsMTguNTkgMjcuMTcsMTYuNSAyNS4yMiwxNS4zOCBDIDI1LjcxLDE0LjcxIDI2LDEzLjg5IDI2LDEzIEMgMjYsMTAuNzkgMjQuMjEsOSAyMiw5IHogIgogICAgc3R5bGU9Im9wYWNpdHk6MTsgZmlsbDojMDAwMDAwOyBmaWxsLW9wYWNpdHk6MTsgZmlsbC1ydWxlOm5vbnplcm87IHN0cm9rZTojMDAwMDAwOyBzdHJva2Utd2lkdGg6MS41OyBzdHJva2UtbGluZWNhcDpyb3VuZDsgc3Ryb2tlLWxpbmVqb2luOm1pdGVyOyBzdHJva2UtbWl0ZXJsaW1pdDo0OyBzdHJva2UtZGFzaGFycmF5Om5vbmU7IHN0cm9rZS1vcGFjaXR5OjE7IiAvPgo8L3N2Zz4K';
			const BLACK_QUEEN 	= 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSI0NSIgaGVpZ2h0PSI0NSI+CiAgPGcgc3R5bGU9Im9wYWNpdHk6MTsgZmlsbDowMDAwMDA7IGZpbGwtb3BhY2l0eToxOyBmaWxsLXJ1bGU6ZXZlbm9kZDsgc3Ryb2tlOiMwMDAwMDA7IHN0cm9rZS13aWR0aDoxLjU7IHN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0OyBzdHJva2UtZGFzaGFycmF5Om5vbmU7IHN0cm9rZS1vcGFjaXR5OjE7Ij4KICAgIDxnIHN0eWxlPSJmaWxsOiMwMDAwMDA7IHN0cm9rZTpub25lOyI+CiAgICAgIDxjaXJjbGUgY3g9IjYiICAgIGN5PSIxMiIgcj0iMi43NSIgLz4KICAgICAgPGNpcmNsZSBjeD0iMTQiICAgY3k9IjkiICByPSIyLjc1IiAvPgogICAgICA8Y2lyY2xlIGN4PSIyMi41IiBjeT0iOCIgIHI9IjIuNzUiIC8+CiAgICAgIDxjaXJjbGUgY3g9IjMxIiAgIGN5PSI5IiAgcj0iMi43NSIgLz4KICAgICAgPGNpcmNsZSBjeD0iMzkiICAgY3k9IjEyIiByPSIyLjc1IiAvPgogICAgPC9nPgogICAgPHBhdGgKICAgICAgIGQ9Ik0gOSwyNiBDIDE3LjUsMjQuNSAzMCwyNC41IDM2LDI2IEwgMzguNSwxMy41IEwgMzEsMjUgTCAzMC43LDEwLjkgTCAyNS41LDI0LjUgTCAyMi41LDEwIEwgMTkuNSwyNC41IEwgMTQuMywxMC45IEwgMTQsMjUgTCA2LjUsMTMuNSBMIDksMjYgeiIKICAgICAgIHN0eWxlPSJzdHJva2UtbGluZWNhcDpidXR0OyBzdHJva2U6IzAwMDAwMDsiIC8+CiAgICA8cGF0aAogICAgICAgZD0iTSA5LDI2IEMgOSwyOCAxMC41LDI4IDExLjUsMzAgQyAxMi41LDMxLjUgMTIuNSwzMSAxMiwzMy41IEMgMTAuNSwzNC41IDEwLjUsMzYgMTAuNSwzNiBDIDksMzcuNSAxMSwzOC41IDExLDM4LjUgQyAxNy41LDM5LjUgMjcuNSwzOS41IDM0LDM4LjUgQyAzNCwzOC41IDM1LjUsMzcuNSAzNCwzNiBDIDM0LDM2IDM0LjUsMzQuNSAzMywzMy41IEMgMzIuNSwzMSAzMi41LDMxLjUgMzMuNSwzMCBDIDM0LjUsMjggMzYsMjggMzYsMjYgQyAyNy41LDI0LjUgMTcuNSwyNC41IDksMjYgeiIKICAgICAgIHN0eWxlPSJzdHJva2UtbGluZWNhcDpidXR0OyIgLz4KICAgIDxwYXRoCiAgICAgICBkPSJNIDExLDM4LjUgQSAzNSwzNSAxIDAgMCAzNCwzOC41IgogICAgICAgc3R5bGU9ImZpbGw6bm9uZTsgc3Ryb2tlOiMwMDAwMDA7IHN0cm9rZS1saW5lY2FwOmJ1dHQ7IiAvPgogICAgPHBhdGgKICAgICAgIGQ9Ik0gMTEsMjkgQSAzNSwzNSAxIDAgMSAzNCwyOSIKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7IHN0cm9rZTojZmZmZmZmOyIgLz4KICAgIDxwYXRoCiAgICAgICBkPSJNIDEyLjUsMzEuNSBMIDMyLjUsMzEuNSIKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7IHN0cm9rZTojZmZmZmZmOyIgLz4KICAgIDxwYXRoCiAgICAgICBkPSJNIDExLjUsMzQuNSBBIDM1LDM1IDEgMCAwIDMzLjUsMzQuNSIKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7IHN0cm9rZTojZmZmZmZmOyIgLz4KICAgIDxwYXRoCiAgICAgICBkPSJNIDEwLjUsMzcuNSBBIDM1LDM1IDEgMCAwIDM0LjUsMzcuNSIKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7IHN0cm9rZTojZmZmZmZmOyIgLz4KICA8L2c+Cjwvc3ZnPgo=';
			const BLACK_ROOK 	= 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSI0NSIgaGVpZ2h0PSI0NSI+CiAgPGcgc3R5bGU9Im9wYWNpdHk6MTsgZmlsbDowMDAwMDA7IGZpbGwtb3BhY2l0eToxOyBmaWxsLXJ1bGU6ZXZlbm9kZDsgc3Ryb2tlOiMwMDAwMDA7IHN0cm9rZS13aWR0aDoxLjU7IHN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0OyBzdHJva2UtZGFzaGFycmF5Om5vbmU7IHN0cm9rZS1vcGFjaXR5OjE7Ij4KICAgIDxwYXRoCiAgICAgIGQ9Ik0gOSwzOSBMIDM2LDM5IEwgMzYsMzYgTCA5LDM2IEwgOSwzOSB6ICIKICAgICAgc3R5bGU9InN0cm9rZS1saW5lY2FwOmJ1dHQ7IiAvPgogICAgPHBhdGgKICAgICAgZD0iTSAxMi41LDMyIEwgMTQsMjkuNSBMIDMxLDI5LjUgTCAzMi41LDMyIEwgMTIuNSwzMiB6ICIKICAgICAgc3R5bGU9InN0cm9rZS1saW5lY2FwOmJ1dHQ7IiAvPgogICAgPHBhdGgKICAgICAgZD0iTSAxMiwzNiBMIDEyLDMyIEwgMzMsMzIgTCAzMywzNiBMIDEyLDM2IHogIgogICAgICBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6YnV0dDsiIC8+CiAgICA8cGF0aAogICAgICBkPSJNIDE0LDI5LjUgTCAxNCwxNi41IEwgMzEsMTYuNSBMIDMxLDI5LjUgTCAxNCwyOS41IHogIgogICAgICBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7IiAvPgogICAgPHBhdGgKICAgICAgZD0iTSAxNCwxNi41IEwgMTEsMTQgTCAzNCwxNCBMIDMxLDE2LjUgTCAxNCwxNi41IHogIgogICAgICBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6YnV0dDsiIC8+CiAgICA8cGF0aAogICAgICBkPSJNIDExLDE0IEwgMTEsOSBMIDE1LDkgTCAxNSwxMSBMIDIwLDExIEwgMjAsOSBMIDI1LDkgTCAyNSwxMSBMIDMwLDExIEwgMzAsOSBMIDM0LDkgTCAzNCwxNCBMIDExLDE0IHogIgogICAgICBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6YnV0dDsiIC8+CiAgICA8cGF0aAogICAgICBkPSJNIDEyLDM1LjUgTCAzMywzNS41IEwgMzMsMzUuNSIKICAgICAgc3R5bGU9ImZpbGw6bm9uZTsgc3Ryb2tlOiNmZmZmZmY7IHN0cm9rZS13aWR0aDoxOyBzdHJva2UtbGluZWpvaW46bWl0ZXI7IiAvPgogICAgPHBhdGgKICAgICAgZD0iTSAxMywzMS41IEwgMzIsMzEuNSIKICAgICAgc3R5bGU9ImZpbGw6bm9uZTsgc3Ryb2tlOiNmZmZmZmY7IHN0cm9rZS13aWR0aDoxOyBzdHJva2UtbGluZWpvaW46bWl0ZXI7IiAvPgogICAgPHBhdGgKICAgICAgZD0iTSAxNCwyOS41IEwgMzEsMjkuNSIKICAgICAgc3R5bGU9ImZpbGw6bm9uZTsgc3Ryb2tlOiNmZmZmZmY7IHN0cm9rZS13aWR0aDoxOyBzdHJva2UtbGluZWpvaW46bWl0ZXI7IiAvPgogICAgPHBhdGgKICAgICAgZD0iTSAxNCwxNi41IEwgMzEsMTYuNSIKICAgICAgc3R5bGU9ImZpbGw6bm9uZTsgc3Ryb2tlOiNmZmZmZmY7IHN0cm9rZS13aWR0aDoxOyBzdHJva2UtbGluZWpvaW46bWl0ZXI7IiAvPgogICAgPHBhdGgKICAgICAgZD0iTSAxMSwxNCBMIDM0LDE0IgogICAgICBzdHlsZT0iZmlsbDpub25lOyBzdHJva2U6I2ZmZmZmZjsgc3Ryb2tlLXdpZHRoOjE7IHN0cm9rZS1saW5lam9pbjptaXRlcjsiIC8+CiAgPC9nPgo8L3N2Zz4K';
			const WHITE_BISHOP 	= 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSI0NSIgaGVpZ2h0PSI0NSI+CiAgPGcgc3R5bGU9Im9wYWNpdHk6MTsgZmlsbDpub25lOyBmaWxsLXJ1bGU6ZXZlbm9kZDsgZmlsbC1vcGFjaXR5OjE7IHN0cm9rZTojMDAwMDAwOyBzdHJva2Utd2lkdGg6MS41OyBzdHJva2UtbGluZWNhcDpyb3VuZDsgc3Ryb2tlLWxpbmVqb2luOnJvdW5kOyBzdHJva2UtbWl0ZXJsaW1pdDo0OyBzdHJva2UtZGFzaGFycmF5Om5vbmU7IHN0cm9rZS1vcGFjaXR5OjE7Ij4KICAgIDxnIHN0eWxlPSJmaWxsOiNmZmZmZmY7IHN0cm9rZTojMDAwMDAwOyBzdHJva2UtbGluZWNhcDpidXR0OyI+IAogICAgICA8cGF0aAogICAgICAgIGQ9Ik0gOSwzNiBDIDEyLjM5LDM1LjAzIDE5LjExLDM2LjQzIDIyLjUsMzQgQyAyNS44OSwzNi40MyAzMi42MSwzNS4wMyAzNiwzNiBDIDM2LDM2IDM3LjY1LDM2LjU0IDM5LDM4IEMgMzguMzIsMzguOTcgMzcuMzUsMzguOTkgMzYsMzguNSBDIDMyLjYxLDM3LjUzIDI1Ljg5LDM4Ljk2IDIyLjUsMzcuNSBDIDE5LjExLDM4Ljk2IDEyLjM5LDM3LjUzIDksMzguNSBDIDcuNjQ2LDM4Ljk5IDYuNjc3LDM4Ljk3IDYsMzggQyA3LjM1NCwzNi4wNiA5LDM2IDksMzYgeiIgLz4KICAgICAgPHBhdGgKICAgICAgICBkPSJNIDE1LDMyIEMgMTcuNSwzNC41IDI3LjUsMzQuNSAzMCwzMiBDIDMwLjUsMzAuNSAzMCwzMCAzMCwzMCBDIDMwLDI3LjUgMjcuNSwyNiAyNy41LDI2IEMgMzMsMjQuNSAzMy41LDE0LjUgMjIuNSwxMC41IEMgMTEuNSwxNC41IDEyLDI0LjUgMTcuNSwyNiBDIDE3LjUsMjYgMTUsMjcuNSAxNSwzMCBDIDE1LDMwIDE0LjUsMzAuNSAxNSwzMiB6IiAvPgogICAgICA8cGF0aAogICAgICAgIGQ9Ik0gMjUgOCBBIDIuNSAyLjUgMCAxIDEgIDIwLDggQSAyLjUgMi41IDAgMSAxICAyNSA4IHoiIC8+CiAgICA8L2c+CiAgICA8cGF0aAogICAgICBkPSJNIDE3LjUsMjYgTCAyNy41LDI2IE0gMTUsMzAgTCAzMCwzMCBNIDIyLjUsMTUuNSBMIDIyLjUsMjAuNSBNIDIwLDE4IEwgMjUsMTgiCiAgICAgIHN0eWxlPSJmaWxsOm5vbmU7IHN0cm9rZTojMDAwMDAwOyBzdHJva2UtbGluZWpvaW46bWl0ZXI7IiAvPgogIDwvZz4KPC9zdmc+Cg==';
			const WHITE_KING 	= 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSI0NSIgaGVpZ2h0PSI0NSI+CiAgPGcgc3R5bGU9ImZpbGw6bm9uZTsgZmlsbC1vcGFjaXR5OjE7IGZpbGwtcnVsZTpldmVub2RkOyBzdHJva2U6IzAwMDAwMDsgc3Ryb2tlLXdpZHRoOjEuNTsgc3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7IHN0cm9rZS1kYXNoYXJyYXk6bm9uZTsgc3Ryb2tlLW9wYWNpdHk6MTsiPgogICAgPHBhdGgKICAgICAgZD0iTSAyMi41LDExLjYzIEwgMjIuNSw2IgogICAgICBzdHlsZT0iZmlsbDpub25lOyBzdHJva2U6IzAwMDAwMDsgc3Ryb2tlLWxpbmVqb2luOm1pdGVyOyIgLz4KICAgIDxwYXRoCiAgICAgIGQ9Ik0gMjAsOCBMIDI1LDgiCiAgICAgIHN0eWxlPSJmaWxsOm5vbmU7IHN0cm9rZTojMDAwMDAwOyBzdHJva2UtbGluZWpvaW46bWl0ZXI7IiAvPgogICAgPHBhdGgKICAgICAgZD0iTSAyMi41LDI1IEMgMjIuNSwyNSAyNywxNy41IDI1LjUsMTQuNSBDIDI1LjUsMTQuNSAyNC41LDEyIDIyLjUsMTIgQyAyMC41LDEyIDE5LjUsMTQuNSAxOS41LDE0LjUgQyAxOCwxNy41IDIyLjUsMjUgMjIuNSwyNSIKICAgICAgc3R5bGU9ImZpbGw6I2ZmZmZmZjsgc3Ryb2tlOiMwMDAwMDA7IHN0cm9rZS1saW5lY2FwOmJ1dHQ7IHN0cm9rZS1saW5lam9pbjptaXRlcjsiIC8+CiAgICA8cGF0aAogICAgICBkPSJNIDExLjUsMzcgQyAxNyw0MC41IDI3LDQwLjUgMzIuNSwzNyBMIDMyLjUsMzAgQyAzMi41LDMwIDQxLjUsMjUuNSAzOC41LDE5LjUgQyAzNC41LDEzIDI1LDE2IDIyLjUsMjMuNSBMIDIyLjUsMjcgTCAyMi41LDIzLjUgQyAxOSwxNiA5LjUsMTMgNi41LDE5LjUgQyAzLjUsMjUuNSAxMS41LDI5LjUgMTEuNSwyOS41IEwgMTEuNSwzNyB6ICIKICAgICAgc3R5bGU9ImZpbGw6I2ZmZmZmZjsgc3Ryb2tlOiMwMDAwMDA7IiAvPgogICAgPHBhdGgKICAgICAgZD0iTSAxMS41LDMwIEMgMTcsMjcgMjcsMjcgMzIuNSwzMCIKICAgICAgc3R5bGU9ImZpbGw6bm9uZTsgc3Ryb2tlOiMwMDAwMDA7IiAvPgogICAgPHBhdGgKICAgICAgZD0iTSAxMS41LDMzLjUgQyAxNywzMC41IDI3LDMwLjUgMzIuNSwzMy41IgogICAgICBzdHlsZT0iZmlsbDpub25lOyBzdHJva2U6IzAwMDAwMDsiIC8+CiAgICA8cGF0aAogICAgICBkPSJNIDExLjUsMzcgQyAxNywzNCAyNywzNCAzMi41LDM3IgogICAgICBzdHlsZT0iZmlsbDpub25lOyBzdHJva2U6IzAwMDAwMDsiIC8+CiAgPC9nPgo8L3N2Zz4K';
			const WHITE_KNIGHT 	= 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSI0NSIgaGVpZ2h0PSI0NSI+CiAgPGcgc3R5bGU9Im9wYWNpdHk6MTsgZmlsbDpub25lOyBmaWxsLW9wYWNpdHk6MTsgZmlsbC1ydWxlOmV2ZW5vZGQ7IHN0cm9rZTojMDAwMDAwOyBzdHJva2Utd2lkdGg6MS41OyBzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDsgc3Ryb2tlLWRhc2hhcnJheTpub25lOyBzdHJva2Utb3BhY2l0eToxOyI+CiAgICA8cGF0aAogICAgICBkPSJNIDIyLDEwIEMgMzIuNSwxMSAzOC41LDE4IDM4LDM5IEwgMTUsMzkgQyAxNSwzMCAyNSwzMi41IDIzLDE4IgogICAgICBzdHlsZT0iZmlsbDojZmZmZmZmOyBzdHJva2U6IzAwMDAwMDsiIC8+CiAgICA8cGF0aAogICAgICBkPSJNIDI0LDE4IEMgMjQuMzgsMjAuOTEgMTguNDUsMjUuMzcgMTYsMjcgQyAxMywyOSAxMy4xOCwzMS4zNCAxMSwzMSBDIDkuOTU4LDMwLjA2IDEyLjQxLDI3Ljk2IDExLDI4IEMgMTAsMjggMTEuMTksMjkuMjMgMTAsMzAgQyA5LDMwIDUuOTk3LDMxIDYsMjYgQyA2LDI0IDEyLDE0IDEyLDE0IEMgMTIsMTQgMTMuODksMTIuMSAxNCwxMC41IEMgMTMuMjcsOS41MDYgMTMuNSw4LjUgMTMuNSw3LjUgQyAxNC41LDYuNSAxNi41LDEwIDE2LjUsMTAgTCAxOC41LDEwIEMgMTguNSwxMCAxOS4yOCw4LjAwOCAyMSw3IEMgMjIsNyAyMiwxMCAyMiwxMCIKICAgICAgc3R5bGU9ImZpbGw6I2ZmZmZmZjsgc3Ryb2tlOiMwMDAwMDA7IiAvPgogICAgPHBhdGgKICAgICAgZD0iTSA5LjUgMjUuNSBBIDAuNSAwLjUgMCAxIDEgOC41LDI1LjUgQSAwLjUgMC41IDAgMSAxIDkuNSAyNS41IHoiCiAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7IHN0cm9rZTojMDAwMDAwOyIgLz4KICAgIDxwYXRoCiAgICAgIGQ9Ik0gMTUgMTUuNSBBIDAuNSAxLjUgMCAxIDEgIDE0LDE1LjUgQSAwLjUgMS41IDAgMSAxICAxNSAxNS41IHoiCiAgICAgIHRyYW5zZm9ybT0ibWF0cml4KDAuODY2LDAuNSwtMC41LDAuODY2LDkuNjkzLC01LjE3MykiCiAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7IHN0cm9rZTojMDAwMDAwOyIgLz4KICA8L2c+Cjwvc3ZnPgo=';
			const WHITE_PAWN 	= 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSI0NSIgaGVpZ2h0PSI0NSI+CiAgPHBhdGgKICAgIGQ9Ik0gMjIsOSBDIDE5Ljc5LDkgMTgsMTAuNzkgMTgsMTMgQyAxOCwxMy44OSAxOC4yOSwxNC43MSAxOC43OCwxNS4zOCBDIDE2LjgzLDE2LjUgMTUuNSwxOC41OSAxNS41LDIxIEMgMTUuNSwyMy4wMyAxNi40NCwyNC44NCAxNy45MSwyNi4wMyBDIDE0LjkxLDI3LjA5IDEwLjUsMzEuNTggMTAuNSwzOS41IEwgMzMuNSwzOS41IEMgMzMuNSwzMS41OCAyOS4wOSwyNy4wOSAyNi4wOSwyNi4wMyBDIDI3LjU2LDI0Ljg0IDI4LjUsMjMuMDMgMjguNSwyMSBDIDI4LjUsMTguNTkgMjcuMTcsMTYuNSAyNS4yMiwxNS4zOCBDIDI1LjcxLDE0LjcxIDI2LDEzLjg5IDI2LDEzIEMgMjYsMTAuNzkgMjQuMjEsOSAyMiw5IHogIgogICAgc3R5bGU9Im9wYWNpdHk6MTsgZmlsbDojZmZmZmZmOyBmaWxsLW9wYWNpdHk6MTsgZmlsbC1ydWxlOm5vbnplcm87IHN0cm9rZTojMDAwMDAwOyBzdHJva2Utd2lkdGg6MS41OyBzdHJva2UtbGluZWNhcDpyb3VuZDsgc3Ryb2tlLWxpbmVqb2luOm1pdGVyOyBzdHJva2UtbWl0ZXJsaW1pdDo0OyBzdHJva2UtZGFzaGFycmF5Om5vbmU7IHN0cm9rZS1vcGFjaXR5OjE7IiAvPgo8L3N2Zz4K';
			const WHITE_QUEEN 	= 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSI0NSIgaGVpZ2h0PSI0NSI+CiAgPGcgc3R5bGU9Im9wYWNpdHk6MTsgZmlsbDojZmZmZmZmOyBmaWxsLW9wYWNpdHk6MTsgZmlsbC1ydWxlOmV2ZW5vZGQ7IHN0cm9rZTojMDAwMDAwOyBzdHJva2Utd2lkdGg6MS41OyBzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDsgc3Ryb2tlLWRhc2hhcnJheTpub25lOyBzdHJva2Utb3BhY2l0eToxOyI+CiAgICA8cGF0aAogICAgICBkPSJNIDkgMTMgQSAyIDIgMCAxIDEgIDUsMTMgQSAyIDIgMCAxIDEgIDkgMTMgeiIKICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEsLTEpIiAvPgogICAgPHBhdGgKICAgICAgZD0iTSA5IDEzIEEgMiAyIDAgMSAxICA1LDEzIEEgMiAyIDAgMSAxICA5IDEzIHoiCiAgICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE1LjUsLTUuNSkiIC8+CiAgICA8cGF0aAogICAgICBkPSJNIDkgMTMgQSAyIDIgMCAxIDEgIDUsMTMgQSAyIDIgMCAxIDEgIDkgMTMgeiIKICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMzIsLTEpIiAvPgogICAgPHBhdGgKICAgICAgZD0iTSA5IDEzIEEgMiAyIDAgMSAxICA1LDEzIEEgMiAyIDAgMSAxICA5IDEzIHoiCiAgICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKDcsLTQuNSkiIC8+CiAgICA8cGF0aAogICAgICBkPSJNIDkgMTMgQSAyIDIgMCAxIDEgIDUsMTMgQSAyIDIgMCAxIDEgIDkgMTMgeiIKICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjQsLTQpIiAvPgogICAgPHBhdGgKICAgICAgZD0iTSA5LDI2IEMgMTcuNSwyNC41IDMwLDI0LjUgMzYsMjYgTCAzOCwxNCBMIDMxLDI1IEwgMzEsMTEgTCAyNS41LDI0LjUgTCAyMi41LDkuNSBMIDE5LjUsMjQuNSBMIDE0LDEwLjUgTCAxNCwyNSBMIDcsMTQgTCA5LDI2IHogIgogICAgICBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6YnV0dDsiIC8+CiAgICA8cGF0aAogICAgICBkPSJNIDksMjYgQyA5LDI4IDEwLjUsMjggMTEuNSwzMCBDIDEyLjUsMzEuNSAxMi41LDMxIDEyLDMzLjUgQyAxMC41LDM0LjUgMTAuNSwzNiAxMC41LDM2IEMgOSwzNy41IDExLDM4LjUgMTEsMzguNSBDIDE3LjUsMzkuNSAyNy41LDM5LjUgMzQsMzguNSBDIDM0LDM4LjUgMzUuNSwzNy41IDM0LDM2IEMgMzQsMzYgMzQuNSwzNC41IDMzLDMzLjUgQyAzMi41LDMxIDMyLjUsMzEuNSAzMy41LDMwIEMgMzQuNSwyOCAzNiwyOCAzNiwyNiBDIDI3LjUsMjQuNSAxNy41LDI0LjUgOSwyNiB6ICIKICAgICAgc3R5bGU9InN0cm9rZS1saW5lY2FwOmJ1dHQ7IiAvPgogICAgPHBhdGgKICAgICAgZD0iTSAxMS41LDMwIEMgMTUsMjkgMzAsMjkgMzMuNSwzMCIKICAgICAgc3R5bGU9ImZpbGw6bm9uZTsiIC8+CiAgICA8cGF0aAogICAgICBkPSJNIDEyLDMzLjUgQyAxOCwzMi41IDI3LDMyLjUgMzMsMzMuNSIKICAgICAgc3R5bGU9ImZpbGw6bm9uZTsiIC8+CiAgPC9nPgo8L3N2Zz4K';
			const WHITE_ROOK 	= 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSI0NSIgaGVpZ2h0PSI0NSI+CiAgPGcgc3R5bGU9Im9wYWNpdHk6MTsgZmlsbDojZmZmZmZmOyBmaWxsLW9wYWNpdHk6MTsgZmlsbC1ydWxlOmV2ZW5vZGQ7IHN0cm9rZTojMDAwMDAwOyBzdHJva2Utd2lkdGg6MS41OyBzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDsgc3Ryb2tlLWRhc2hhcnJheTpub25lOyBzdHJva2Utb3BhY2l0eToxOyI+CiAgICA8cGF0aAogICAgICBkPSJNIDksMzkgTCAzNiwzOSBMIDM2LDM2IEwgOSwzNiBMIDksMzkgeiAiCiAgICAgIHN0eWxlPSJzdHJva2UtbGluZWNhcDpidXR0OyIgLz4KICAgIDxwYXRoCiAgICAgIGQ9Ik0gMTIsMzYgTCAxMiwzMiBMIDMzLDMyIEwgMzMsMzYgTCAxMiwzNiB6ICIKICAgICAgc3R5bGU9InN0cm9rZS1saW5lY2FwOmJ1dHQ7IiAvPgogICAgPHBhdGgKICAgICAgZD0iTSAxMSwxNCBMIDExLDkgTCAxNSw5IEwgMTUsMTEgTCAyMCwxMSBMIDIwLDkgTCAyNSw5IEwgMjUsMTEgTCAzMCwxMSBMIDMwLDkgTCAzNCw5IEwgMzQsMTQiCiAgICAgIHN0eWxlPSJzdHJva2UtbGluZWNhcDpidXR0OyIgLz4KICAgIDxwYXRoCiAgICAgIGQ9Ik0gMzQsMTQgTCAzMSwxNyBMIDE0LDE3IEwgMTEsMTQiIC8+CiAgICA8cGF0aAogICAgICBkPSJNIDMxLDE3IEwgMzEsMjkuNSBMIDE0LDI5LjUgTCAxNCwxNyIKICAgICAgc3R5bGU9InN0cm9rZS1saW5lY2FwOmJ1dHQ7IHN0cm9rZS1saW5lam9pbjptaXRlcjsiIC8+CiAgICA8cGF0aAogICAgICBkPSJNIDMxLDI5LjUgTCAzMi41LDMyIEwgMTIuNSwzMiBMIDE0LDI5LjUiIC8+CiAgICA8cGF0aAogICAgICBkPSJNIDExLDE0IEwgMzQsMTQiCiAgICAgIHN0eWxlPSJmaWxsOm5vbmU7IHN0cm9rZTojMDAwMDAwOyBzdHJva2UtbGluZWpvaW46bWl0ZXI7IiAvPgogIDwvZz4KPC9zdmc+Cg==';

			const BG_COLOR_LIGHT  = '#FFE4D4';
			const BG_COLOR_DARK   = '#805A44';
			const AVAILABLE_COLOR = '#6D8C83';
			const SELECTED_COLOR  = '#D8E2DF';
			const POSSIBLE_COLOR  = '#4DB378';
			const KILLER_COLOR	  = '#E69D1E';
			const THREAT_COLOR	  = '#E86D37';
			const CHECK_COLOR	  = '#E80D0C';

			const ROWS_COUNT   = 8;
			const COLS_COUNT   = 8;
			const CELL_WIDTH   = Math.floor(window.innerHeight / ROWS_COUNT) - 5;
			const CELL_HEIGHT  = Math.floor(window.innerHeight / COLS_COUNT) - 5;
			const BORDER_WIDTH = 2;
			const MARGIN_TOP   = 10;
			const MARGIN_LEFT  = 10;
			const DC_MARGIN    = 10;
			
			const NONE   = 0;
			const PAWN   = 1;
			const ROOK   = 2;
			const KNIGHT = 3;
			const BISHOP = 4;
			const QUEEN  = 5;
			const KING   = 6;
			const WHITE  = 7;
			const BLACK  = 8;

			const LOWER_ZINDEX = 20;
			const UPPER_ZINDEX = 21;
			
			let blackPiecesMatrix;
			let whitePiecesMatrix;
			let firstPawnMove;
			let turnMode;
			let currentFocus;
			
			function drawTable() {
				function bkColor(i, j) {
					let iMod = i % 2;
					let jMod = j % 2;
					return iMod === jMod ? BG_COLOR_DARK : BG_COLOR_LIGHT;
				}
				let bgTBody = document.createElement('tbody');
				bgTBody.id = 'bg-tbody';
				for (let i = 0; i < ROWS_COUNT; ++i) {
					let row = document.createElement('tr');
					for (let j = 0; j < COLS_COUNT; ++j) {
						let cell = document.createElement('td');
						cell.style.background = bkColor(i, j);
						cell.style.width = '' + CELL_WIDTH + 'px';
						cell.style.height = '' + CELL_HEIGHT + 'px';
						cell.style.margin = '0px';
						cell.style.padding = '0px';
						row.appendChild(cell);
					}
					bgTBody.appendChild(row);
				}
				let bgTable = document.createElement('table');
				bgTable.id = 'bg-table';
				bgTable.style.border = 'solid ' + BORDER_WIDTH + 'px ' + BG_COLOR_DARK;
				bgTable.cellSpacing = '0';
				bgTable.appendChild(bgTBody);
				let layer0 = document.createElement('div');
				layer0.id = 'layer-0';
				layer0.style.position = 'absolute';
				layer0.style.left = '' + MARGIN_LEFT + 'px';
				layer0.style.top = '' + MARGIN_TOP + 'px';
				layer0.style.zIndex = 1;
				layer0.appendChild(bgTable);
				let layer1 = document.createElement('div');
				layer1.id = 'layer-1';
				layer1.style.position = 'absolute';
				layer1.style.left = '' + MARGIN_LEFT + 'px';
				layer1.style.top = '' + MARGIN_TOP + 'px';
				layer1.style.zIndex = 2;
				let layer2 = document.createElement('div');
				layer2.id = 'layer-2';
				layer2.style.position = 'absolute';
				layer2.style.left = '' + MARGIN_LEFT + 'px';
				layer2.style.top = '' + MARGIN_TOP + 'px';
				layer2.style.zIndex = 3;
				let layer3 = document.createElement('div');
				layer3.id = 'layer-3';
				layer3.style.position = 'absolute';
				layer3.style.left = '' + MARGIN_LEFT + 'px';
				layer3.style.top = '' + MARGIN_TOP + 'px';
				layer3.style.zIndex = 4;
				let layer4 = document.createElement('div');
				layer4.id = 'layer-4';
				layer4.style.position = 'absolute';
				layer4.style.left = '' + MARGIN_LEFT + 'px';
				layer4.style.top = '' + MARGIN_TOP + 'px';
				layer4.style.zIndex = 5;
				let layer5 = document.createElement('div');
				layer5.id = 'layer-5';
				layer5.style.position = 'absolute';
				layer5.style.left = '' + MARGIN_LEFT + 'px';
				layer5.style.top = '' + MARGIN_TOP + 'px';
				layer5.style.zIndex = 6;
				let layer6 = document.createElement('div');
				layer6.id = 'layer-6';
				layer6.style.position = 'absolute';
				layer6.style.left = '' + MARGIN_LEFT + 'px';
				layer6.style.top = '' + MARGIN_TOP + 'px';
				layer6.style.zIndex = 7;
				let layer7 = document.createElement('div');
				layer7.id = 'layer-black';
				layer7.style.position = 'absolute';
				layer7.style.left = '' + MARGIN_LEFT + 'px';
				layer7.style.top = '' + MARGIN_TOP + 'px';
				layer7.style.zIndex = LOWER_ZINDEX;
				let layer8 = document.createElement('div');
				layer8.id = 'layer-white';
				layer8.style.position = 'absolute';
				layer8.style.left = '' + MARGIN_LEFT + 'px';
				layer8.style.top = '' + MARGIN_TOP + 'px';
				layer8.style.zIndex = UPPER_ZINDEX;
				let layer9 = document.createElement('div');
				layer9.id = 'layer-links';
				layer9.style.position = 'absolute';
				layer9.style.left = '' + MARGIN_LEFT + 'px';
				layer9.style.top = '' + MARGIN_TOP + 'px';
				layer9.style.zIndex = 40;
				let layerA = document.createElement('div');
				layerA.id = 'layer-check-threat';
				layerA.style.position = 'absolute';
				layerA.style.left = '' + MARGIN_LEFT + 'px';
				layerA.style.top = '' + MARGIN_TOP + 'px';
				layerA.style.zIndex = 30;
				let layerB = document.createElement('div');
				layerB.id = 'layer-white-won';
				layerB.style.position = 'absolute';
				layerB.style.left = '' + MARGIN_LEFT + 'px';
				layerB.style.top = '' + MARGIN_TOP + 'px';
				layerB.style.zIndex = 31;
				let layerC = document.createElement('div');
				layerC.id = 'layer-black-won';
				layerC.style.position = 'absolute';
				layerC.style.left = '' + MARGIN_LEFT + 'px';
				layerC.style.top = '' + MARGIN_TOP + 'px';
				layerC.style.zIndex = 32;
				let root = document.getElementById('root');
				root.appendChild(layer0);
				root.appendChild(layer1);
				root.appendChild(layer2);
				root.appendChild(layer3);
				root.appendChild(layer4);
				root.appendChild(layer5);
				root.appendChild(layer6);
				root.appendChild(layer7);
				root.appendChild(layer8);
				root.appendChild(layer9);
				root.appendChild(layerA);
				root.appendChild(layerB);
				root.appendChild(layerC);
			}

			function clearPosition(value) {
				let index = value.indexOf("px");
				return parseInt(value.substring(0, index));
			}

			function calcLeft(column) {
				return column * CELL_WIDTH + BORDER_WIDTH;
			}

			function calcTop(row) {
				return row * CELL_HEIGHT + BORDER_WIDTH;
			}

			function calcCoord(elem) {
				let className = elem.className;
				let tokens = className.split(" ");
				let first = tokens[0];
				let second = tokens[1];
				let x = parseInt(first.substring(1));
				let y = parseInt(second.substring(1));
				return { x, y };
			}

			function buildBlackPiecesMatrix() {
				blackPiecesMatrix = [];
				blackPiecesMatrix.push([ROOK, KNIGHT, BISHOP, QUEEN, KING, BISHOP, KNIGHT, ROOK]);
				blackPiecesMatrix.push([PAWN, PAWN, PAWN, PAWN, PAWN, PAWN, PAWN, PAWN]);
				for (let i = 2; i < ROWS_COUNT; ++i)
					blackPiecesMatrix.push([NONE, NONE, NONE, NONE, NONE, NONE, NONE, NONE]);
			}

			function buildWhitePiecesMatrix() {
				whitePiecesMatrix = [];
				for (let i = 0; i < ROWS_COUNT - 2; ++i)
					whitePiecesMatrix.push([NONE, NONE, NONE, NONE, NONE, NONE, NONE, NONE]);
				whitePiecesMatrix.push([PAWN, PAWN, PAWN, PAWN, PAWN, PAWN, PAWN, PAWN]);
				whitePiecesMatrix.push([ROOK, KNIGHT, BISHOP, QUEEN, KING, BISHOP, KNIGHT, ROOK]);
			}
			
			function buildMatrixes() {
				buildBlackPiecesMatrix();
				buildWhitePiecesMatrix();
			}

			function buildDefaultPiece() {
				let image = document.createElement('img');
				image.style.position = 'absolute';
				image.style.width = '' + CELL_WIDTH + 'px';
				image.style.height = '' + CELL_HEIGHT + 'px';
				return image;
			}

			function buildBlackPiece(i, j) {
				let piece = blackPiecesMatrix[i][j];
				let source;
				let className;
				switch (piece) {
					case PAWN:		
						source = BLACK_PAWN;	
						className = 'piece black pawn';
						break;
					case ROOK: 		
						source = BLACK_ROOK; 	
						className = 'piece black rook';
						break;
					case KNIGHT: 	
						source = BLACK_KNIGHT; 	
						className = 'piece black knight';
						break;
					case BISHOP:	
						source = BLACK_BISHOP;	
						className = 'piece black bishop';
						break;
					case QUEEN:		
						source = BLACK_QUEEN;	
						className = 'piece black queen';
						break;
					case KING:		
						source = BLACK_KING;
						className = 'piece black king';	
						break;
					case NONE:
					default: return;
				}
				let image = buildDefaultPiece();
				image.src = source;
				image.className = 'v' + i + ' h' + j + ' ' + className;
				image.style.top = '' + calcTop(i) + 'px';
				image.style.left = '' + calcLeft(j) + 'px';
				document.getElementById('layer-black').appendChild(image);
			}

			function buildAllBlackPieces() {
				for (let i = 0; i < blackPiecesMatrix.length; ++i)
					for (let j = 0; j < blackPiecesMatrix[i].length; ++j)
						buildBlackPiece(i, j);
			}

			function buildWhitePiece(i, j) {
				let piece = whitePiecesMatrix[i][j];
				let source;
				let className;
				switch (piece) {
					case PAWN:		
						source = WHITE_PAWN;	
						className = 'piece white pawn';
						break;
					case ROOK: 		
						source = WHITE_ROOK; 	
						className = 'piece white rook';
						break;
					case KNIGHT: 	
						source = WHITE_KNIGHT; 	
						className = 'piece white knight';
						break;
					case BISHOP:	
						source = WHITE_BISHOP;	
						className = 'piece white bishop';
						break;
					case QUEEN:		
						source = WHITE_QUEEN;	
						className = 'piece white queen';
						break;
					case KING:		
						source = WHITE_KING;	
						className = 'piece white king'
						break;
					case NONE:
					default: return;
				}
				let image = buildDefaultPiece();
				image.src = source;
				image.className = 'v' + i + ' h' + j + ' ' + className;
				image.style.top = '' + calcTop(i) + 'px';
				image.style.left = '' + calcLeft(j) + 'px';
				document.getElementById('layer-white').appendChild(image);
			}

			function buildAllWhitePieces() {
				for (let i = 0; i < whitePiecesMatrix.length; ++i)
					for (let j = 0; j < whitePiecesMatrix[i].length; ++j)
						buildWhitePiece(i, j);
			}

			function buildPieces() {
				buildAllBlackPieces();
				buildAllWhitePieces();
			}

			function buildFirstPawnMove() {
				let result = [];
				for (let i = 0; i < ROWS_COUNT; ++i) {
					let row = [];
					let flag = i == 1 || i == (ROWS_COUNT - 2);
					for (let j = 0; j < COLS_COUNT; ++j)
						row.push(flag);
					result.push(row);
				}
				firstPawnMove = result;
			}

			function buildAvailablePiecesDecoration() {
				let avTBody = document.createElement('tbody');
				for (let i = 0; i < ROWS_COUNT; ++i) {
					let row = document.createElement('tr');
					for (let j = 0; j < COLS_COUNT; ++j) {
						let shadow = document.createElement('div');
						shadow.style.backgroundColor = AVAILABLE_COLOR;
						shadow.style.width = '100%';
						shadow.style.height = '100%';
						shadow.style.borderRadius = '50%';
						shadow.style.boxShadow = '0px 0px 20px ' + AVAILABLE_COLOR;
						let cell = document.createElement('td');
						cell.id = 'availability-' + i + '-' + j;
						cell.className = 'v' + i + ' h' + j;
						cell.style.padding = '' + DC_MARGIN + 'px';
						cell.style.width = '' + (CELL_WIDTH - 2 * DC_MARGIN) + 'px';
						cell.style.height = '' + (CELL_HEIGHT - 2 * DC_MARGIN) + 'px';
						cell.style.visibility = 'hidden';
						cell.appendChild(shadow);
						row.appendChild(cell);
					}
					avTBody.appendChild(row);
				}
				let avTable = document.createElement('table');
				avTable.id = 'av-table';
				avTable.style.border = 'solid ' + BORDER_WIDTH + 'px transparent';
				avTable.cellSpacing = '0';
				avTable.appendChild(avTBody);
				document.getElementById('layer-1').appendChild(avTable);
			}

			function buildcurrentFocusDecoration() {
				let slTBody = document.createElement('tbody');
				for (let i = 0; i < ROWS_COUNT; ++i) {
					let row = document.createElement('tr');
					for (let j = 0; j < COLS_COUNT; ++j) {
						let shadow = document.createElement('div');
						shadow.style.backgroundColor = SELECTED_COLOR;
						shadow.style.width = '100%';
						shadow.style.height = '100%';
						shadow.style.borderRadius = '50%';
						shadow.style.boxShadow = '0px 0px 20px ' + SELECTED_COLOR;
						let cell = document.createElement('td');
						cell.id = 'selected-' + i + '-' + j;
						cell.className = 'v' + i + ' h' + j;
						cell.style.padding = '' + DC_MARGIN + 'px';
						cell.style.width = '' + (CELL_WIDTH - 2 * DC_MARGIN) + 'px';
						cell.style.height = '' + (CELL_HEIGHT - 2 * DC_MARGIN) + 'px';
						cell.style.visibility = 'hidden';
						cell.appendChild(shadow);
						row.appendChild(cell);
					}
					slTBody.appendChild(row);
				}
				let slTable = document.createElement('table');
				slTable.id = 'av-table';
				slTable.style.border = 'solid ' + BORDER_WIDTH + 'px transparent';
				slTable.cellSpacing = '0';
				slTable.appendChild(slTBody);
				document.getElementById('layer-2').appendChild(slTable);
			}

			function buildPossibleMovesDecoration() {
				let pmTBody = document.createElement('tbody');
				for (let i = 0; i < ROWS_COUNT; ++i) {
					let row = document.createElement('tr');
					for (let j = 0; j < COLS_COUNT; ++j) {
						let shadow = document.createElement('div');
						shadow.style.backgroundColor = POSSIBLE_COLOR;
						shadow.style.width = '100%';
						shadow.style.height = '100%';
						shadow.style.borderRadius = '50%';
						shadow.style.boxShadow = '0px 0px 20px ' + POSSIBLE_COLOR;
						let cell = document.createElement('td');
						cell.id = 'possible-move-' + i + '-' + j;
						cell.className = 'v' + i + ' h' + j;
						cell.style.padding = '' + DC_MARGIN + 'px';
						cell.style.width = '' + (CELL_WIDTH - 2 * DC_MARGIN) + 'px';
						cell.style.height = '' + (CELL_HEIGHT - 2 * DC_MARGIN) + 'px';
						cell.style.visibility = 'hidden';
						cell.appendChild(shadow);
						row.appendChild(cell);
					}
					pmTBody.appendChild(row);
				}
				let pmTable = document.createElement('table');
				pmTable.id = 'pm-table';
				pmTable.style.border = 'solid ' + BORDER_WIDTH + 'px transparent';
				pmTable.cellSpacing = '0';
				pmTable.appendChild(pmTBody);
				document.getElementById('layer-3').appendChild(pmTable);
			}

			function buildKillerMovesDecoration() {
				let kmTBody = document.createElement('tbody');
				for (let i = 0; i < ROWS_COUNT; ++i) {
					let row = document.createElement('tr');
					for (let j = 0; j < COLS_COUNT; ++j) {
						let shadow = document.createElement('div');
						shadow.style.backgroundColor = KILLER_COLOR;
						shadow.style.width = '100%';
						shadow.style.height = '100%';
						shadow.style.borderRadius = '50%';
						shadow.style.boxShadow = '0px 0px 20px ' + KILLER_COLOR;
						let cell = document.createElement('td');
						cell.id = 'killer-move-' + i + '-' + j;
						cell.className = 'v' + i + ' h' + j;
						cell.style.padding = '' + DC_MARGIN + 'px';
						cell.style.width = '' + (CELL_WIDTH - 2 * DC_MARGIN) + 'px';
						cell.style.height = '' + (CELL_HEIGHT - 2 * DC_MARGIN) + 'px';
						cell.style.visibility = 'hidden';
						cell.appendChild(shadow);
						row.appendChild(cell);
					}
					kmTBody.appendChild(row);
				}
				let kmTable = document.createElement('table');
				kmTable.id = 'pm-table';
				kmTable.style.border = 'solid ' + BORDER_WIDTH + 'px transparent';
				kmTable.cellSpacing = '0';
				kmTable.appendChild(kmTBody);
				document.getElementById('layer-4').appendChild(kmTable);
			}

			function buildThreatDecoration() {
				let tbody = document.createElement('tbody');
				for (let i = 0; i < ROWS_COUNT; ++i) {
					let row = document.createElement('tr');
					for (let j = 0; j < COLS_COUNT; ++j) {
						let shadow = document.createElement('div');
						shadow.style.backgroundColor = THREAT_COLOR;
						shadow.style.width = '100%';
						shadow.style.height = '100%';
						shadow.style.borderRadius = '50%';
						shadow.style.boxShadow = '0px 0px 20px ' + THREAT_COLOR;
						let cell = document.createElement('td');
						cell.id = 'threat-' + i + '-' + j;
						cell.className = 'v' + i + ' h' + j;
						cell.style.padding = '' + DC_MARGIN + 'px';
						cell.style.width = '' + (CELL_WIDTH - 2 * DC_MARGIN) + 'px';
						cell.style.height = '' + (CELL_HEIGHT - 2 * DC_MARGIN) + 'px';
						cell.style.visibility = 'hidden';
						cell.appendChild(shadow);
						row.appendChild(cell);
					}
					tbody.appendChild(row);
				}
				let table = document.createElement('table');
				table.id = 'threat-table';
				table.style.border = 'solid ' + BORDER_WIDTH + 'px transparent';
				table.cellSpacing = '0';
				table.appendChild(tbody);
				document.getElementById('layer-5').appendChild(table);
			}

			function buildCheckDecoration() {
				let tbody = document.createElement('tbody');
				for (let i = 0; i < ROWS_COUNT; ++i) {
					let row = document.createElement('tr');
					for (let j = 0; j < COLS_COUNT; ++j) {
						let shadow = document.createElement('div');
						shadow.style.backgroundColor = CHECK_COLOR;
						shadow.style.width = '100%';
						shadow.style.height = '100%';
						shadow.style.borderRadius = '50%';
						shadow.style.boxShadow = '0px 0px 20px ' + CHECK_COLOR;
						let cell = document.createElement('td');
						cell.id = 'check-' + i + '-' + j;
						cell.className = 'v' + i + ' h' + j;
						cell.style.padding = '' + DC_MARGIN + 'px';
						cell.style.width = '' + (CELL_WIDTH - 2 * DC_MARGIN) + 'px';
						cell.style.height = '' + (CELL_HEIGHT - 2 * DC_MARGIN) + 'px';
						cell.style.visibility = 'hidden';
						cell.appendChild(shadow);
						row.appendChild(cell);
					}
					tbody.appendChild(row);
				}
				let table = document.createElement('table');
				table.id = 'check-table';
				table.style.border = 'solid ' + BORDER_WIDTH + 'px transparent';
				table.cellSpacing = '0';
				table.appendChild(tbody);
				document.getElementById('layer-6').appendChild(table);
			}

			function buildLinksDecoration() {
				let linksTBody = document.createElement('tbody');
				for (let i = 0; i < ROWS_COUNT; ++i) {
					let row = document.createElement('tr');
					for (let j = 0; j < COLS_COUNT; ++j) {
						let link = document.createElement('a');
						link.id = 'link-' + i + '-' + j;
						link.className = 'v' + i + ' h' + j;
						link.href = "javascript:void(0)";
						link.style.display = 'block';
						link.style.margin = '0px';
						link.style.padding = '0px';
						link.style.width = '' + CELL_WIDTH + 'px';
						link.style.height = '' + CELL_HEIGHT + 'px';
						let cell = document.createElement('td');
						cell.className = 'v' + i + ' h' + j;
						cell.style.margin = '0px';
						cell.style.padding = '0px';
						cell.style.width = '' + CELL_WIDTH + 'px';
						cell.style.height = '' + CELL_HEIGHT + 'px';
						cell.style.visibility = 'hidden';
						cell.appendChild(link);
						row.appendChild(cell);
					}
					linksTBody.appendChild(row);
				}
				let linksTable = document.createElement('table');
				linksTable.id = 'links-table';
				linksTable.style.border = 'solid ' + BORDER_WIDTH + 'px transparent';
				linksTable.cellSpacing = '0';
				linksTable.appendChild(linksTBody);
				document.getElementById('layer-links').appendChild(linksTable);
			}

			function buildCheckThreatDecoration() {
				let text = document.createElement('div');
				text.innerText = CHECK_LABEL;
				text.style.fontFamily = 'Arial, Helvetica, sans-serif';
				text.style.color = "#CC1700";
				text.style.fontStyle = 'italic';
				text.style.fontWeight = 'bold';
				text.style.fontSize = CELL_HEIGHT + 'px';
				text.style.textTransform = 'uppercase';
				let background = document.createElement('div');
				background.id = 'check-threat-display';
				background.style.display = 'table-cell';
				background.style.width = '' + (BORDER_WIDTH + ROWS_COUNT * CELL_WIDTH) + 'px';
				background.style.height = '' + (BORDER_WIDTH + COLS_COUNT * CELL_HEIGHT) + 'px';
				background.style.verticalAlign = 'middle';
				background.style.textAlign = 'center';
				background.style.visibility = 'hidden';
				background.appendChild(text);
				document.getElementById('layer-check-threat').appendChild(background);
			}

			function buildWhiteWonDecoration() {
				let width = 2 * BORDER_WIDTH + ROWS_COUNT * CELL_WIDTH;
				let height = 2 * BORDER_WIDTH + COLS_COUNT * CELL_WIDTH;
				let text = document.createElement('div');
				text.innerText = WHITE_WINS_LABEL;
				text.style.fontFamily = 'Arial, Helvetica, sans-serif';
				text.style.color = "#FFFFFF";
				text.style.fontStyle = 'normal';
				text.style.fontWeight = 'bold';
				text.style.fontSize = CELL_HEIGHT + 'px';
				text.style.textTransform = 'uppercase';
				let background = document.createElement('div');
				background.id = 'white-won-display';
				background.style.display = 'table-cell';
				background.style.background = 'rgba(0, 0, 0, 0.7)';
				background.style.width = '' + width + 'px';
				background.style.height = '' + height + 'px';
				background.style.verticalAlign = 'middle';
				background.style.textAlign = 'center';
				background.style.visibility = 'hidden';
				background.appendChild(text);
				document.getElementById('layer-white-won').appendChild(background);
			}

			function buildBlackWonDecoration() {
				let width = 2 * BORDER_WIDTH + ROWS_COUNT * CELL_WIDTH;
				let height = 2 * BORDER_WIDTH + COLS_COUNT * CELL_WIDTH;
				let text = document.createElement('div');
				text.innerText = BLACK_WINS_LABEL;
				text.style.fontFamily = 'Arial, Helvetica, sans-serif';
				text.style.color = "#000000";
				text.style.fontStyle = 'normal';
				text.style.fontWeight = 'bold';
				text.style.fontSize = CELL_HEIGHT + 'px';
				text.style.textTransform = 'uppercase';
				let background = document.createElement('div');
				background.id = 'black-won-display';
				background.style.display = 'table-cell';
				background.style.background = 'rgba(255, 255, 255, 0.7)';
				background.style.width = '' + width + 'px';
				background.style.height = '' + height + 'px';
				background.style.verticalAlign = 'middle';
				background.style.textAlign = 'center';
				background.style.visibility = 'hidden';
				background.appendChild(text);
				document.getElementById('layer-black-won').appendChild(background);
			}

			function buildDecorations() {
				buildAvailablePiecesDecoration();
				buildcurrentFocusDecoration();
				buildPossibleMovesDecoration();
				buildKillerMovesDecoration();
				buildThreatDecoration();
				buildWhiteWonDecoration();
				buildBlackWonDecoration();
				buildCheckDecoration();
				buildLinksDecoration();
				buildCheckThreatDecoration();
			}

			function checkCoord(x, y) {
				return x >= 0 && x < ROWS_COUNT &&
					y >= 0 && y < COLS_COUNT;
			}

			function isFree(x, y) {
				return checkCoord(x, y) && blackPiecesMatrix[x][y] === NONE && whitePiecesMatrix[x][y] === NONE;
			}

			function hasBlackPiece(x, y) {
				return checkCoord(x, y) && blackPiecesMatrix[x][y] !== NONE;
			}

			function hasWhitePiece(x, y) {
				return checkCoord(x, y) && whitePiecesMatrix[x][y] !== NONE;
			}

			function hasRivalPiece(x, y) {
				return checkCoord(x, y) && 
					((turnMode === WHITE && blackPiecesMatrix[x][y] !== NONE) || 
						(turnMode === BLACK && whitePiecesMatrix[x][y] !== NONE));
			}

			function hasFriendPiece(x, y) {
				return checkCoord(x, y) && 
					((turnMode === WHITE && whitePiecesMatrix[x][y] !== NONE) || 
						(turnMode === BLACK && blackPiecesMatrix[x][y] !== NONE));
			}

			function getColor(piece) {
				let coord = calcCoord(piece);
				let blackType = blackPiecesMatrix[coord.x][coord.y];
				let whiteType = whitePiecesMatrix[coord.x][coord.y];
				if (whiteType !== NONE)
					return WHITE;
				if (blackType !== NONE)
					return BLACK;
				return null;
			}

			function getPieceType(piece) {
				let coord = calcCoord(piece);
				let blackType = blackPiecesMatrix[coord.x][coord.y];
				let whiteType = whitePiecesMatrix[coord.x][coord.y];
				return whiteType === NONE ? blackType : whiteType;
			}

			function mayMovePawn(piece) {
				let color = getColor(piece);
				if (color === null)
					return;
				let coord = calcCoord(piece);
				if (color === WHITE) {
					let firstPosition = { x: (coord.x - 1), y: coord.y };
					// let secondPosition = { x: (coord.x - 2), y: coord.y };
					let thirdPosition = { x: (coord.x - 1), y: (coord.y - 1) };
					let fourthPosition = { x: (coord.x - 1), y: (coord.y + 1) };
					return isFree(firstPosition.x, firstPosition.y) ||
						hasRivalPiece(thirdPosition.x, thirdPosition.y) ||
						hasRivalPiece(fourthPosition.x, fourthPosition.y);
				} else {
					let firstPosition = { x: (coord.x + 1), y: coord.y };
					// let secondPosition = { x: (coord.x + 2), y: coord.y };
					let thirdPosition = { x: (coord.x + 1), y: (coord.y - 1) };
					let fourthPosition = { x: (coord.x + 1), y: (coord.y + 1) };
					return isFree(firstPosition.x, firstPosition.y) ||
						hasRivalPiece(thirdPosition.x, thirdPosition.y) ||
						hasRivalPiece(fourthPosition.x, fourthPosition.y);
				}
			}

			function mayMoveRook(piece) {
				let coord = calcCoord(piece);
				let positions = [
					{ x: (coord.x - 1), y: coord.y },
					{ x: (coord.x + 1), y: coord.y },
					{ x: coord.x, y: (coord.y - 1) },
					{ x: coord.x, y: (coord.y + 1) }
				];
				let result = false;
				for (let i = 0; i < positions.length && !result; ++i)
					result = result || isFree(positions[i].x, positions[i].y) || hasRivalPiece(positions[i].x, positions[i].y);
				return result;
			}

			function mayMoveKnight(piece) {
				let coord = calcCoord(piece);
				let positions = [
					{ x: (coord.x - 2), y: (coord.y + 1) },
					{ x: (coord.x - 1), y: (coord.y + 2) },
					{ x: (coord.x + 1), y: (coord.y + 2) },
					{ x: (coord.x + 2), y: (coord.y + 1) },
					{ x: (coord.x - 2), y: (coord.y - 1) },
					{ x: (coord.x - 1), y: (coord.y - 2) },
					{ x: (coord.x + 1), y: (coord.y - 2) },
					{ x: (coord.x + 2), y: (coord.y - 1) }
				];
				let result = false;
				for (let i = 0; i < positions.length && !result; ++i)
					result = result || isFree(positions[i].x, positions[i].y) || hasRivalPiece(positions[i].x, positions[i].y);
				return result;
			}

			function mayMoveBishop(piece) {
				let coord = calcCoord(piece);
				let positions = [
					{ x: (coord.x - 1), y: (coord.y - 1) },
					{ x: (coord.x + 1), y: (coord.y - 1) },
					{ x: (coord.x - 1), y: (coord.y + 1) },
					{ x: (coord.x + 1), y: (coord.y + 1) },
				];
				let result = false;
				for (let i = 0; i < positions.length && !result; ++i)
					result = result || isFree(positions[i].x, positions[i].y) || hasRivalPiece(positions[i].x, positions[i].y);
				return result;
			}

			function mayMoveQueen(piece) {
				let coord = calcCoord(piece);
				let positions = [
					{ x: (coord.x - 1), y: coord.y },
					{ x: (coord.x + 1), y: coord.y },
					{ x: coord.x, y: (coord.y - 1) },
					{ x: coord.x, y: (coord.y + 1) },
					{ x: (coord.x - 1), y: (coord.y - 1) },
					{ x: (coord.x + 1), y: (coord.y - 1) },
					{ x: (coord.x - 1), y: (coord.y + 1) },
					{ x: (coord.x + 1), y: (coord.y + 1) },
				];
				let result = false;
				for (let i = 0; i < positions.length && !result; ++i)
					result = result || isFree(positions[i].x, positions[i].y) || hasRivalPiece(positions[i].x, positions[i].y);
				return result;
			}

			function mayMoveKing(piece) {
				let coord = calcCoord(piece);
				let positions = [
					{ x: (coord.x - 1), y: coord.y },
					{ x: (coord.x + 1), y: coord.y },
					{ x: coord.x, y: (coord.y - 1) },
					{ x: coord.x, y: (coord.y + 1) },
					{ x: (coord.x - 1), y: (coord.y - 1) },
					{ x: (coord.x + 1), y: (coord.y - 1) },
					{ x: (coord.x - 1), y: (coord.y + 1) },
					{ x: (coord.x + 1), y: (coord.y + 1) },
				];
				let result = false;
				for (let i = 0; i < positions.length && !result; ++i)
					result = result || isFree(positions[i].x, positions[i].y) || hasRivalPiece(positions[i].x, positions[i].y);
				return result;
			}

			function mayMove(piece) {
				let pieceType = getPieceType(piece);
				switch (pieceType) {
					case PAWN:   return mayMovePawn(piece);
					case ROOK:   return mayMoveRook(piece);
					case KNIGHT: return mayMoveKnight(piece);
					case BISHOP: return mayMoveBishop(piece);
					case QUEEN:  return mayMoveQueen(piece);
					case KING:   return mayMoveKing(piece);
					default:     return false;
				}
			}

			function selectPiece() {
				let piece = event.target;
				let coord = calcCoord(piece);
				currentFocus = coord;
				resetSelection();
				showSelection(coord.x, coord.y);
				resetPossibleMoves();
				showAllPossibleMoves(piece);
			}

			function showAction(i, j, callback) {
				let elem = document.getElementById('link-' + i + '-' + j);
				elem.style.visibility = 'visible';
				elem.onclick = callback;
			}

			function hideAction(i, j) {
				let elem = document.getElementById('link-' + i + '-' + j);
				elem.style.visibility = 'hidden';
				elem.onclick = null;
			}

			function resetActions() {
				for (let i = 0; i < ROWS_COUNT; ++i)
					for (let j = 0; j < COLS_COUNT; ++j) {
						let elem = document.getElementById('link-' + i + '-' + j);
						elem.style.visibility = 'hidden';
						elem.onclick = null;
					}
			}

			function showThreat(i, j) {
				let elem = document.getElementById('threat-' + i + '-' + j);
				elem.style.visibility = 'visible';
			}

			function hideThreat(i, j) {
				let elem = document.getElementById('threat-' + i + '-' + j);
				if (elem.style.visibility === 'visible')
					elem.style.visibility = 'hidden';
			}

			function resetThreats() {
				for (let i = 0; i < ROWS_COUNT; ++i)
					for (let j = 0; j < COLS_COUNT; ++j)
						hideThreat(i, j);
			}

			function showCheck(i, j) {
				let elem = document.getElementById('check-' + i + '-' + j);
				elem.style.visibility = 'visible';
			}

			function hideCheck(i, j) {
				let elem = document.getElementById('check-' + i + '-' + j);
				if (elem.style.visibility === 'visible')
					elem.style.visibility = 'hidden';
			}

			function resetChecks() {
				for (let i = 0; i < ROWS_COUNT; ++i)
					for (let j = 0; j < COLS_COUNT; ++j)
						hideCheck(i, j);
			}

			function showAvailability(i, j) {
				let elem = document.getElementById('availability-' + i + '-' + j);
				elem.style.visibility = 'visible';
			}

			function hideAvailability(i, j) {
				let elem = document.getElementById('availability-' + i + '-' + j);
				if (elem.style.visibility === 'visible') {
					elem.style.visibility = 'hidden';
					hideAction(i, j);
				}
			}

			function resetAvailability() {
				for (let i = 0; i < ROWS_COUNT; ++i)
					for (let j = 0; j < COLS_COUNT; ++j)
						hideAvailability(i, j);
			}

			function showSelection(i, j) {
				let elem = document.getElementById('selected-' + i + '-' + j);
				elem.style.visibility = 'visible';
			}

			function hideSelection(i, j) {
				let elem = document.getElementById('selected-' + i + '-' + j);
				if (elem.style.visibility === 'visible')
					elem.style.visibility = 'hidden';
			}

			function resetSelection() {
				for (let i = 0; i < ROWS_COUNT; ++i)
					for (let j = 0; j < COLS_COUNT; ++j)
						hideSelection(i, j);
			}

			function showPawnPossibleMoves(piece) {
				let color = getColor(piece);
				if (color === null)
					return;
				let coord = calcCoord(piece);
				let firstTime = firstPawnMove[coord.x][coord.y];
				if (color === WHITE) {
					let firstPosition = { x: (coord.x - 1), y: coord.y };
					let secondPosition = { x: (coord.x - 2), y: coord.y };
					let thirdPosition = { x: (coord.x - 1), y: (coord.y - 1) };
					let fourthPosition = { x: (coord.x - 1), y: (coord.y + 1) };
					if (isFree(firstPosition.x, firstPosition.y)) {
						if (firstTime && isFree(secondPosition.x, secondPosition.y))
							showPossibleMove(secondPosition.x, secondPosition.y)
						showPossibleMove(firstPosition.x, firstPosition.y);
					}
					if (hasRivalPiece(thirdPosition.x, thirdPosition.y))
						showPossibleMove(thirdPosition.x, thirdPosition.y);
					if (hasRivalPiece(fourthPosition.x, fourthPosition.y))
						showPossibleMove(fourthPosition.x, fourthPosition.y);
				} else {
					let firstPosition = { x: (coord.x + 1), y: coord.y };
					let secondPosition = { x: (coord.x + 2), y: coord.y };
					let thirdPosition = { x: (coord.x + 1), y: (coord.y - 1) };
					let fourthPosition = { x: (coord.x + 1), y: (coord.y + 1) };
					if (isFree(firstPosition.x, firstPosition.y)) {
						if (firstTime && isFree(secondPosition.x, secondPosition.y))
							showPossibleMove(secondPosition.x, secondPosition.y)
						showPossibleMove(firstPosition.x, firstPosition.y);
					}
					if (hasRivalPiece(thirdPosition.x, thirdPosition.y))
						showPossibleMove(thirdPosition.x, thirdPosition.y);
					if (hasRivalPiece(fourthPosition.x, fourthPosition.y))
						showPossibleMove(fourthPosition.x, fourthPosition.y);
				}
			}

			function showRookPossibleMoves(piece) {
				let limit, i, j;
				let coord = calcCoord(piece);
				limit = true;
				i = coord.x - 1;
				while (i >= 0 && limit) {
					limit = isFree(i, coord.y);
					if (limit || hasRivalPiece(i, coord.y))
						showPossibleMove(i, coord.y);
					--i;
				}
				limit = true;
				i = coord.x + 1;
				while (i < ROWS_COUNT && limit) {
					limit = isFree(i, coord.y);
					if (limit || hasRivalPiece(i, coord.y))
						showPossibleMove(i, coord.y);
					++i;
				}
				limit = true;
				i = coord.y - 1;
				while (i >= 0 && limit) {
					limit = isFree(coord.x, i);
					if (limit || hasRivalPiece(coord.x, i))
						showPossibleMove(coord.x, i);
					--i;
				}
				limit = true;
				i = coord.y + 1; 
				while (i < COLS_COUNT && limit) {
					limit = isFree(coord.x, i);
					if (limit || hasRivalPiece(coord.x, i))
						showPossibleMove(coord.x, i);
					++i;
				}
			}

			function showKnightPossibleMoves(piece) {
				let coord = calcCoord(piece);
				let positions = [
					{ x: (coord.x - 2), y: (coord.y + 1) },
					{ x: (coord.x - 1), y: (coord.y + 2) },
					{ x: (coord.x + 1), y: (coord.y + 2) },
					{ x: (coord.x + 2), y: (coord.y + 1) },
					{ x: (coord.x - 2), y: (coord.y - 1) },
					{ x: (coord.x - 1), y: (coord.y - 2) },
					{ x: (coord.x + 1), y: (coord.y - 2) },
					{ x: (coord.x + 2), y: (coord.y - 1) }
				];
				for (let i = 0; i < positions.length; ++i)
					if (isFree(positions[i].x, positions[i].y) || hasRivalPiece(positions[i].x, positions[i].y))
						showPossibleMove(positions[i].x, positions[i].y);
			}

			function showBishopPossibleMoves(piece) {
				let limit, i, j;
				let coord = calcCoord(piece);
				limit = true;
				i = coord.x - 1;
				j = coord.y - 1;
				while (i >= 0 && j >= 0 && limit) {
					limit = isFree(i, j);
					if (limit || hasRivalPiece(i, j))
						showPossibleMove(i, j);
					--i;
					--j;
				}
				limit = true;
				i = coord.x - 1;
				j = coord.y + 1;
				while (i >= 0 && j < COLS_COUNT && limit) {
					limit = isFree(i, j);
					if (limit || hasRivalPiece(i, j))
						showPossibleMove(i, j);
					--i;
					++j;
				}
				limit = true;
				i = coord.x + 1;
				j = coord.y - 1;
				while (i < ROWS_COUNT && j >= 0 && limit) {
					limit = isFree(i, j);
					if (limit || hasRivalPiece(i, j))
						showPossibleMove(i, j);
					++i;
					--j;
				}
				limit = true;
				i = coord.x + 1;
				j = coord.y + 1;
				while (i < ROWS_COUNT && j < COLS_COUNT && limit) {
					limit = isFree(i, j);
					if (limit || hasRivalPiece(i, j))
						showPossibleMove(i, j);
					++i;
					++j;
				}
			}

			function showQueenPossibleMoves(piece) {
				let limit, i, j;
				let coord = calcCoord(piece);
				limit = true;
				i = coord.x - 1;
				while (i >= 0 && limit) {
					limit = isFree(i, coord.y);
					if (limit || hasRivalPiece(i, coord.y))
						showPossibleMove(i, coord.y);
					--i;
				}
				limit = true;
				i = coord.x + 1;
				while (i < ROWS_COUNT && limit) {
					limit = isFree(i, coord.y);
					if (limit || hasRivalPiece(i, coord.y))
						showPossibleMove(i, coord.y);
					++i;
				}
				limit = true;
				i = coord.y - 1;
				while (i >= 0 && limit) {
					limit = isFree(coord.x, i);
					if (limit || hasRivalPiece(coord.x, i))
						showPossibleMove(coord.x, i);
					--i;
				}
				limit = true;
				i = coord.y + 1; 
				while (i < COLS_COUNT && limit) {
					limit = isFree(coord.x, i);
					if (limit || hasRivalPiece(coord.x, i))
						showPossibleMove(coord.x, i);
					++i;
				}
				limit = true;
				i = coord.x - 1;
				j = coord.y - 1;
				while (i >= 0 && j >= 0 && limit) {
					limit = isFree(i, j);
					if (limit || hasRivalPiece(i, j))
						showPossibleMove(i, j);
					--i;
					--j;
				}
				limit = true;
				i = coord.x - 1;
				j = coord.y + 1;
				while (i >= 0 && j < COLS_COUNT && limit) {
					limit = isFree(i, j);
					if (limit || hasRivalPiece(i, j))
						showPossibleMove(i, j);
					--i;
					++j;
				}
				limit = true;
				i = coord.x + 1;
				j = coord.y - 1;
				while (i < ROWS_COUNT && j >= 0 && limit) {
					limit = isFree(i, j);
					if (limit || hasRivalPiece(i, j))
						showPossibleMove(i, j);
					++i;
					--j;
				}
				limit = true;
				i = coord.x + 1;
				j = coord.y + 1;
				while (i < ROWS_COUNT && j < COLS_COUNT && limit) {
					limit = isFree(i, j);
					if (limit || hasRivalPiece(i, j))
						showPossibleMove(i, j);
					++i;
					++j;
				}
			}

			function showKingPossibleMoves(piece) {
				let coord = calcCoord(piece);
				let positions = [
					{ x: (coord.x - 1), y: (coord.y - 1) },
					{ x: (coord.x - 1), y: coord.y },
					{ x: (coord.x - 1), y: (coord.y + 1) },
					{ x: coord.x, y: (coord.y - 1) },
					{ x: coord.x, y: (coord.y + 1) },
					{ x: (coord.x + 1), y: (coord.y - 1) },
					{ x: (coord.x + 1), y: coord.y },
					{ x: (coord.x + 1), y: (coord.y + 1) },
				];
				for (let i = 0; i < positions.length; ++i)
					if (isFree(positions[i].x, positions[i].y) || hasRivalPiece(positions[i].x, positions[i].y))
						showPossibleMove(positions[i].x, positions[i].y);
			}

			function showAllPossibleMoves(piece) {
				let pieceType = getPieceType(piece);
				switch (pieceType) {
					case PAWN: 
						showPawnPossibleMoves(piece);
						break;
					case ROOK:
						showRookPossibleMoves(piece);
						break;
					case KNIGHT:
						showKnightPossibleMoves(piece);
						break;
					case BISHOP:
						showBishopPossibleMoves(piece);
						break;
					case QUEEN:
						showQueenPossibleMoves(piece);
						break;
					case KING:
						showKingPossibleMoves(piece);
						break;
				}
			}

			function showPossibleMove(i, j) {
				let className = hasRivalPiece(i, j) ? 'killer' : 'possible';
				let elem = document.getElementById(className + '-move-' + i + '-' + j);
				elem.style.visibility = 'visible';
				showAction(i, j, movePiece);
			}

			function hidePossibleMove(i, j) {
				let elem;
				elem = document.getElementById('possible-move-' + i + '-' + j);
				if (elem.style.visibility === 'visible') {
					elem.style.visibility = 'hidden';
					hideAction(i, j);
				}
				elem = document.getElementById('killer-move-' + i + '-' + j);
				if (elem.style.visibility === 'visible') {
					elem.style.visibility = 'hidden';
					hideAction(i, j);
				}
			}

			function resetPossibleMoves() {
				for (let i = 0; i < ROWS_COUNT; ++i)
					for (let j = 0; j < COLS_COUNT; ++j)
						hidePossibleMove(i, j);
			}

			function showEliminationAnimation(x, y, callback) {
				let className = 'v' + x + ' h' + y + ' piece ' + (turnMode === WHITE ? 'black' : 'white');
				let query = document.getElementsByClassName(className);
				let elem = query && query.length ? query[0] : null;
				if (elem === null) {
					callback();
					return;
				}
				elem.parentNode.removeChild(elem);
				let oldPiece;
				if (turnMode === WHITE) {
					oldPiece = blackPiecesMatrix[x][y];
					blackPiecesMatrix[x][y] = NONE;
				} else {
					oldPiece = whitePiecesMatrix[x][y];
					whitePiecesMatrix[x][y] = NONE;
				}
				if (oldPiece === KING && turnMode === WHITE)
					showWhiteWins();
				else if (oldPiece === KING && turnMode === BLACK)
					showBlackWins();
				else
					callback();
			}

			function showMoveAnimation(piece, oldPlace, newPlace, callback) {
				let oldRealPos = { x: calcTop(oldPlace.x), y: calcLeft(oldPlace.y) };
				let newRealPos = { x: calcTop(newPlace.x), y: calcLeft(newPlace.y) };
				let slurpX = (newRealPos.x - oldRealPos.x) / 50;
				let slurpY = (newRealPos.y - oldRealPos.y) / 50;
				let currentX = oldRealPos.x;
				let currentY = oldRealPos.y;
				let time = 0;
				function eliminateRivalPlace(x, y) {
				}
				function finishAnimation() {
					piece.style.top = '' + newRealPos.x + 'px';
					piece.style.left = '' + newRealPos.y + 'px';	
					let color = getColor(piece);
					let pieceType = getPieceType(piece);
					if (color === WHITE) {
						whitePiecesMatrix[oldPlace.x][oldPlace.y] = NONE;
						whitePiecesMatrix[newPlace.x][newPlace.y] = pieceType;
					} else {
						blackPiecesMatrix[oldPlace.x][oldPlace.y] = NONE;
						blackPiecesMatrix[newPlace.x][newPlace.y] = pieceType;
					}
					if (pieceType === PAWN && firstPawnMove[oldPlace.x][oldPlace.y])
						firstPawnMove[oldPlace.x][oldPlace.y] = false;
					let className = piece.className;
					let tokens = className.split(" ");
					let newClassName = 'v' + newPlace.x + ' h' + newPlace.y;
					for (let i = 2; i < tokens.length; ++i)
						newClassName = newClassName + ' ' + tokens[i];
					piece.className = newClassName;
					if (hasRivalPiece(newPlace.x, newPlace.y))
						showEliminationAnimation(newPlace.x, newPlace.y, callback);
					else
						callback();
				}
				function showMoveAnimationR() {
					currentX = currentX + slurpX;
					currentY = currentY + slurpY;
					piece.style.top = '' + currentX + 'px';
					piece.style.left = '' + currentY + 'px';
					if (time++ < 50)
						setTimeout(showMoveAnimationR, 10);
					else
						finishAnimation();
				}
				showMoveAnimationR();
			}

			function finishTurn() {
				if (turnMode === WHITE)
					startBlackTurn();
				else
					startWhiteTurn();
			}

			function movePiece() {
				resetAvailability();
				resetSelection();
				resetPossibleMoves();
				resetChecks();
				resetThreats();
				let query = document.getElementsByClassName('piece v' + currentFocus.x + ' h' + currentFocus.y);
				let piece = query && query.length ? query[0] : null;
				if (piece === null)
					return;
				let oldPlace = currentFocus;
				let newPlace = calcCoord(event.target);
				showMoveAnimation(piece, oldPlace, newPlace, finishTurn);
			}

			function enableSelection(piece) {
				let coord = calcCoord(piece);
				showAvailability(coord.x, coord.y);
				showAction(coord.x, coord.y, selectPiece);
			}

			function showCheckmate() {
				// TODO implement
				// Does nothing
			}

			function checkGameover(color, threats) {
				// TODO implement
				return false;
			}

			function showCheckThreat() {
				const duration = 300;
				let display = document.getElementById('check-threat-display');
				display.style.visibility = 'visible';
				let index = 0;
				const finishAnimation = () => {
					display.style.visibility = 'hidden';
					display.style.opacity = 1.0;
					display.style.transform = 'none';
				}
				const animation = () => {
					let factor = index * (10 / duration);
					display.style.opacity = 1 - factor;
					display.style.transform = 'scale(' + (1 + factor) + ', ' + (1 + factor) + ')';
					if (++index < (duration / 10))
						setTimeout(animation, 10);
					else
						finishAnimation();
				};
				animation();
			}

			function showWhiteWins() {
				document.getElementById('white-won-display').style.visibility = 'visible';
			}

			function showBlackWins() {
				document.getElementById('black-won-display').style.visibility = 'visible';
			}

			function showKingThreatsByColor(threats, color) {
				let kingPiece = document.getElementsByClassName('piece king ' + color)[0];
				let kingPos = calcCoord(kingPiece);
				showCheck(kingPos.x, kingPos.y);
				for (let i = 0; i < threats.length; ++i) {
					let piecePos = threats[i];
					showThreat(piecePos.x, piecePos.y);
				}
			}

			function showKingThreats(threats) {
				showKingThreatsByColor(threats, 'white');
				showKingThreatsByColor(threats, 'black');
				if (turnMode === WHITE)
					freeWhiteMove();
				else
					freeBlackMove();
			}

			function checkIfPawnThreatsKing(color, kingPos, piecePos) {
				let firstPos, secondPos;
				if (color === 'white') {
					firstPos = { x: (piecePos.x + 1), y: (piecePos.y - 1) };
					secondPos = { x: (piecePos.x + 1), y: (piecePos.y + 1) };
				} else {
					firstPos = { x: (piecePos.x - 1), y: (piecePos.y - 1) };
					secondPos = { x: (piecePos.x - 1), y: (piecePos.y + 1) };
				}
				let result = (firstPos.x === kingPos.x && firstPos.y === kingPos.y) ||
					(secondPos.x === kingPos.x && secondPos.y === kingPos.y);
				return result;
			}

			function checkIfRookThreatsKing(color, kingPos, piecePos) {
				let keepGoing, i;
				let rivalPiecesMatrix = color === 'white' ? whitePiecesMatrix : blackPiecesMatrix;
				keepGoing = true;
				i = piecePos.x - 1;
				while (i >= 0 && keepGoing) {
					let newPos = { x: i, y: piecePos.y };
					keepGoing = isFree(newPos.x, newPos.y);
					if (!keepGoing && rivalPiecesMatrix[newPos.x][newPos.y] === KING)
						return true;
					--i;
				}
				keepGoing = true;
				i = piecePos.x + 1
				while (i < rivalPiecesMatrix.length && keepGoing) {
					let newPos = { x: i, y: piecePos.y };
					keepGoing = isFree(newPos.x, newPos.y);
					if (!keepGoing && rivalPiecesMatrix[newPos.x][newPos.y] === KING)
						return true;
					++i;
				}
				keepGoing = true;
				i = piecePos.y - 1;
				while (i >= 0 && keepGoing) {
					let newPos = { x: piecePos.x, y: i };
					keepGoing = isFree(newPos.x, newPos.y);
					if (!keepGoing && rivalPiecesMatrix[newPos.x][newPos.y] === KING)
						return true;
					--i;
				}
				keepGoing = true;
				i = piecePos.y + 1;
				while (i < rivalPiecesMatrix[0].length && keepGoing) {
					let newPos = { x: piecePos.x, y: i };
					keepGoing = isFree(newPos.x, newPos.y);
					if (!keepGoing && rivalPiecesMatrix[newPos.x][newPos.y] === KING)
						return true;
					++i;
				}
				return false;
			}

			function checkIfKnightThreatsKing(color, kingPos, piecePos) {
				let positions = [
					{ x: (piecePos.x - 2), y: (piecePos.y + 1) },
					{ x: (piecePos.x - 1), y: (piecePos.y + 2) },
					{ x: (piecePos.x + 1), y: (piecePos.y + 2) },
					{ x: (piecePos.x + 2), y: (piecePos.y + 1) },
					{ x: (piecePos.x - 2), y: (piecePos.y - 1) },
					{ x: (piecePos.x - 1), y: (piecePos.y - 2) },
					{ x: (piecePos.x + 1), y: (piecePos.y - 2) },
					{ x: (piecePos.x + 2), y: (piecePos.y - 1) }
				];
				let isAThreat = false;
				for (let i = 0; i < positions.length && !isAThreat; ++i) {
					let pos = positions[i];
					isAThreat = pos.x === kingPos.x && pos.y === kingPos.y;
				}
				return isAThreat;
			}

			function checkIfBishopThreatsKing(color, kingPos, piecePos) {
				let keepGoing, i, j;
				let rivalPiecesMatrix = color === 'white' ? whitePiecesMatrix : blackPiecesMatrix;
				keepGoing = true;
				i = piecePos.x - 1;
				j = piecePos.y - 1;
				while (i >= 0 && j >= 0 && keepGoing) {
					let newPos = { x: i, y: j };
					keepGoing = isFree(newPos.x, newPos.y);
					if (!keepGoing && rivalPiecesMatrix[newPos.x][newPos.y] === KING)
						return true;
					--i;
					--j;
				}
				keepGoing = true;
				i = piecePos.x + 1
				j = piecePos.y - 1;
				while (i < rivalPiecesMatrix.length && j >= 0 && keepGoing) {
					let newPos = { x: i, y: j };
					keepGoing = isFree(newPos.x, newPos.y);
					if (!keepGoing && rivalPiecesMatrix[newPos.x][newPos.y] === KING)
						return true;
					++i;
					--j;
				}
				keepGoing = true;
				i = piecePos.x - 1;
				j = piecePos.y + 1;
				while (i >= 0 && j < rivalPiecesMatrix[0].length && keepGoing) {
					let newPos = { x: i, y: j };
					keepGoing = isFree(newPos.x, newPos.y);
					if (!keepGoing && rivalPiecesMatrix[newPos.x][newPos.y] === KING)
						return true;
					--i;
					++j;
				}
				keepGoing = true;
				i = piecePos.x + 1;
				j = piecePos.y + 1;
				while (i < rivalPiecesMatrix.length && j < rivalPiecesMatrix[0].length && keepGoing) {
					let newPos = { x: i, y: j };
					keepGoing = isFree(newPos.x, newPos.y);
					if (!keepGoing && rivalPiecesMatrix[newPos.x][newPos.y] === KING)
						return true;
					++i;
					++j;
				}
				return false;
			}

			function checkIfQueenThreatsKing(color, kingPos, piecePos) {
				let keepGoing, i, j;
				let rivalPiecesMatrix = color === 'white' ? whitePiecesMatrix : blackPiecesMatrix;
				keepGoing = true;
				i = piecePos.x - 1;
				while (i >= 0 && keepGoing) {
					let newPos = { x: i, y: piecePos.y };
					keepGoing = isFree(newPos.x, newPos.y);
					if (!keepGoing && rivalPiecesMatrix[newPos.x][newPos.y] === KING)
						return true;
					--i;
				}
				keepGoing = true;
				i = piecePos.x + 1
				while (i < rivalPiecesMatrix.length && keepGoing) {
					let newPos = { x: i, y: piecePos.y };
					keepGoing = isFree(newPos.x, newPos.y);
					if (!keepGoing && rivalPiecesMatrix[newPos.x][newPos.y] === KING)
						return true;
					++i;
				}
				keepGoing = true;
				i = piecePos.y - 1;
				while (i >= 0 && keepGoing) {
					let newPos = { x: piecePos.x, y: i };
					keepGoing = isFree(newPos.x, newPos.y);
					if (!keepGoing && rivalPiecesMatrix[newPos.x][newPos.y] === KING)
						return true;
					--i;
				}
				keepGoing = true;
				i = piecePos.y + 1;
				while (i < rivalPiecesMatrix[0].length && keepGoing) {
					let newPos = { x: piecePos.x, y: i };
					keepGoing = isFree(newPos.x, newPos.y);
					if (!keepGoing && rivalPiecesMatrix[newPos.x][newPos.y] === KING)
						return true;
					++i;
				}
				keepGoing = true;
				i = piecePos.x - 1;
				j = piecePos.y - 1;
				while (i >= 0 && j >= 0 && keepGoing) {
					let newPos = { x: i, y: j };
					keepGoing = isFree(newPos.x, newPos.y);
					if (!keepGoing && rivalPiecesMatrix[newPos.x][newPos.y] === KING)
						return true;
					--i;
					--j;
				}
				keepGoing = true;
				i = piecePos.x + 1
				j = piecePos.y - 1;
				while (i < rivalPiecesMatrix.length && j >= 0 && keepGoing) {
					let newPos = { x: i, y: j };
					keepGoing = isFree(newPos.x, newPos.y);
					if (!keepGoing && rivalPiecesMatrix[newPos.x][newPos.y] === KING)
						return true;
					++i;
					--j;
				}
				keepGoing = true;
				i = piecePos.x - 1;
				j = piecePos.y + 1;
				while (i >= 0 && j < rivalPiecesMatrix[0].length && keepGoing) {
					let newPos = { x: i, y: j };
					keepGoing = isFree(newPos.x, newPos.y);
					if (!keepGoing && rivalPiecesMatrix[newPos.x][newPos.y] === KING)
						return true;
					--i;
					++j;
				}
				keepGoing = true;
				i = piecePos.x + 1;
				j = piecePos.y + 1;
				while (i < rivalPiecesMatrix.length && j < rivalPiecesMatrix[0].length && keepGoing) {
					let newPos = { x: i, y: j };
					keepGoing = isFree(newPos.x, newPos.y);
					if (!keepGoing && rivalPiecesMatrix[newPos.x][newPos.y] === KING)
						return true;
					++i;
					++j;
				}
				return false;
			}

			function checkIfKingThreatsRivalKing(color, kingPos, piecePos) {
				let positions = [
					{ x: (piecePos.x - 1), y: (piecePos.y - 1) },
					{ x: (piecePos.x - 1), y: piecePos.y },
					{ x: (piecePos.x - 1), y: (piecePos.y + 1) },
					{ x: piecePos.x, y: (piecePos.y - 1) },
					{ x: piecePos.x, y: (piecePos.y + 1) },
					{ x: (piecePos.x + 1), y: (piecePos.y - 1) },
					{ x: (piecePos.x + 1), y: piecePos.y },
					{ x: (piecePos.x + 1), y: (piecePos.y + 1) },
				];
				let isAThreat = false;
				for (let i = 0; i < positions.length && !isAThreat; ++i) {
					let pos = positions[i];
					isAThreat = pos.x === kingPos.x && pos.y === kingPos.y;
				}
				return isAThreat;
			}

			function testCheckmateByColor(color) {
				let threats = [];
				let kingPiece = document.getElementsByClassName('piece king ' + color)[0];
				let kingPos = calcCoord(kingPiece);
				let piecesMatrix = color === 'white' ? blackPiecesMatrix : whitePiecesMatrix;
				for (let i = 0; i < piecesMatrix.length; ++i)
					for (let j = 0; j < piecesMatrix[i].length; ++j) {
						let piece = piecesMatrix[i][j];
						let piecePos = { x: i, y: j };
						let isAThreat = false;
						switch (piece) {
							case PAWN:
								isAThreat = checkIfPawnThreatsKing(color, kingPos, piecePos);
								break;
							case ROOK:
								isAThreat = checkIfRookThreatsKing(color, kingPos, piecePos);
								break;
							case KNIGHT:
								isAThreat = checkIfKnightThreatsKing(color, kingPos, piecePos);
								break;
							case BISHOP:
								isAThreat = checkIfBishopThreatsKing(color, kingPos, piecePos);
								break;
							case QUEEN:
								isAThreat = checkIfQueenThreatsKing(color, kingPos, piecePos);
								break;
							case KING:
								isAThreat = checkIfKingThreatsRivalKing(color, kingPos, piecePos);
								break;
						}
						if (isAThreat)
							threats.push({ x: i, y: j });
					}
				let gameover = false;
				let hasThreats = threats.length > 0;
				if (hasThreats > 0) {
					showCheck(kingPos.x, kingPos.y);
					for (let i = 0; i < threats.length; ++i)
						showThreat(threats[i].x, threats[i].y);
					gameover = checkGameover(color, threats);
				}
				return { gameover, hasThreats };
			}

			function testCheckmate() {
				let whiteResult = testCheckmateByColor('white');
				let blackResult = testCheckmateByColor('black');
				if (whiteResult.hasThreats || blackResult.hasThreats)
					showCheckThreat();
				return whiteResult.gameover || blackResult.gameover;
			}

			function freeBlackMove() {
				let blackPieces = document.getElementsByClassName('piece black');
				for (let i = 0; i < blackPieces.length; ++i)
					if (mayMove(blackPieces[i]))
						enableSelection(blackPieces[i]);
			}

			function startBlackTurn() {
				turnMode = BLACK;
				document.getElementById('layer-white').style.zIndex = LOWER_ZINDEX;
				document.getElementById('layer-black').style.zIndex = UPPER_ZINDEX;
				let checkmate = testCheckmate();
				if (checkmate)
					showCheckmate();
				else
					freeBlackMove();
			}

			function freeWhiteMove() {
				let whitePieces = document.getElementsByClassName('piece white');
				for (let i = 0; i < whitePieces.length; ++i)
					if (mayMove(whitePieces[i]))
						enableSelection(whitePieces[i]);
			}

			function startWhiteTurn() {
				turnMode = WHITE;
				document.getElementById('layer-white').style.zIndex = UPPER_ZINDEX;
				document.getElementById('layer-black').style.zIndex = LOWER_ZINDEX;
				let checkmate = testCheckmate();
				if (checkmate)
					showCheckmate();
				else
					freeWhiteMove();
			}

			function startGame() {
				startWhiteTurn();
			}
			
			function init() {
				drawTable();
				buildMatrixes();
				buildPieces();
				buildFirstPawnMove();
				buildDecorations();
				currentFocus = null;
			}
			
			init();
			startGame();

		</script>
	</body>
</html>
